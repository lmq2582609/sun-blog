<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第5章 C语言 | 小太阳的博客</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="https://lmq2582609.github.io/sun-blog/assets/images/logo.png">
    <meta name="description" content="一名爱学习的好同志">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="https://lmq2582609.github.io/sun-blog/assets/css/0.styles.67a899d4.css" as="style"><link rel="preload" href="https://lmq2582609.github.io/sun-blog/assets/js/app.911b0be4.js" as="script"><link rel="preload" href="https://lmq2582609.github.io/sun-blog/assets/js/4.eab32c03.js" as="script"><link rel="preload" href="https://lmq2582609.github.io/sun-blog/assets/js/1.3b1cd4a9.js" as="script"><link rel="preload" href="https://lmq2582609.github.io/sun-blog/assets/js/3.047693cb.js" as="script"><link rel="prefetch" href="https://lmq2582609.github.io/sun-blog/assets/js/10.2f2d4cd8.js"><link rel="prefetch" href="https://lmq2582609.github.io/sun-blog/assets/js/11.c9774bee.js"><link rel="prefetch" href="https://lmq2582609.github.io/sun-blog/assets/js/12.9751fddf.js"><link rel="prefetch" href="https://lmq2582609.github.io/sun-blog/assets/js/13.667022f4.js"><link rel="prefetch" href="https://lmq2582609.github.io/sun-blog/assets/js/14.03f01b79.js"><link rel="prefetch" href="https://lmq2582609.github.io/sun-blog/assets/js/15.fd4eecbb.js"><link rel="prefetch" href="https://lmq2582609.github.io/sun-blog/assets/js/16.f640fc37.js"><link rel="prefetch" href="https://lmq2582609.github.io/sun-blog/assets/js/17.8dcfa0ca.js"><link rel="prefetch" href="https://lmq2582609.github.io/sun-blog/assets/js/18.d48f2971.js"><link rel="prefetch" href="https://lmq2582609.github.io/sun-blog/assets/js/19.5ad356bf.js"><link rel="prefetch" href="https://lmq2582609.github.io/sun-blog/assets/js/20.12133820.js"><link rel="prefetch" href="https://lmq2582609.github.io/sun-blog/assets/js/5.a99d2be0.js"><link rel="prefetch" href="https://lmq2582609.github.io/sun-blog/assets/js/6.4236bf8c.js"><link rel="prefetch" href="https://lmq2582609.github.io/sun-blog/assets/js/7.0c2226aa.js"><link rel="prefetch" href="https://lmq2582609.github.io/sun-blog/assets/js/8.6dcac8cf.js"><link rel="prefetch" href="https://lmq2582609.github.io/sun-blog/assets/js/9.498e4c93.js">
    <link rel="stylesheet" href="https://lmq2582609.github.io/sun-blog/assets/css/0.styles.67a899d4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>小太阳的博客</h3> <p class="description" data-v-59e6cb88>一名爱学习的好同志</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2023
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/https:/lmq2582609.github.io/sun-blog/" class="home-link router-link-active"><img src="https://lmq2582609.github.io/sun-blog/assets/images/logo.png" alt="小太阳的博客" class="logo"> <span class="site-name">小太阳的博客</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/" class="nav-link router-link-active"><i class="undefined"></i>
  计算机之道
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><!----> <!----> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>6</h3> <h6 data-v-1fad0c41>文章</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>0</h3> <h6 data-v-1fad0c41>标签</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/" class="nav-link router-link-active"><i class="undefined"></i>
  计算机之道
</a></div> <!----></nav> <ul class="sidebar-links"><li><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/" aria-current="page" class="sidebar-link">前言</a></li><li><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/1/第1章-计算机简述.html" class="sidebar-link">第1章-计算机简述</a></li><li><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/2/第2章-机器指令与编程语言.html" class="sidebar-link">第2章-机器指令与编程语言</a></li><li><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/3/第3章-编译原理.html" class="sidebar-link">第3章-编译原理</a></li><li><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/4/第4章-汇编语言.html" class="sidebar-link">第4章-汇编语言</a></li><li><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/5/第5章-C语言.html" class="active sidebar-link">第5章-C语言</a></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>第5章 C语言</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2023
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">第5章 C语言</h1> <div data-v-8a445198><!----> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>2022/11/20</span></i> <!----> <!----></div></div> <div class="theme-reco-content content__default"><p>程序的代码段可以抽象为C语言的函数；内存的最小存储单元是1byte，可以抽象为是C语言中的类型系统，比如C语言中的int占4byte，long占8byte(32位机占4byte)等等；如果想表示一个不规则的内存单元，比如9byte、11byte的数据，可以抽象为C语言中的结构体struct(Java中的类)；如果想表示一连串相同类型的数据，可以抽象为C语言中的数组等等。</p> <p>无论什么编程语言，计算机最终执行的都是机器码(ISA指令集)，而机器码的上层就是汇编语言，汇编语言的上层就是C语言，C语言由编译器编译为汇编语言，汇编语言由汇编器编译为机器码。那么可以理解为汇编语言的上层可以是任何一种高级语言，只要能通过编译器编译为汇编语言，最终都可以执行。</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image.81f133cb.png" alt="C语言"></p> <p>假设现在有2个代码段，分别是代码段A和代码段B，代码段A想在内存中存放一个int类型的数据，需要占用4byte，在栈中该如何操作呢？由于栈内存是从高地址向低地址扩张的，所以只需要栈顶寄存器减4byte就可以开辟数据的空间了。</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image2.578ecfc4.png" alt="C语言"></p> <p>此时代码段A调用代码段B，代码段B也需要操作这个4byte的数据，那么就可以将(sp-4)的内存地址取出来，传递给代码段B，这样虽然数据是代码段A私有的，但以地址的方式传递给代码段B，使得代码段B也可以操作这个数据。</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image3.c1e4575c.png" alt="C语言"></p> <p>代码段B获取到这个int类型数据的内存地址就可以进行操作了，这样代码段A和代码段B操作的都是同一个int类型的数据，这种对数据地址的操作，可以抽象为指针操作，这就是C语言中的核心。如果你认为汇编语言是一门操作寄存器的语言，那么C语言就是一门操作内存的语言。</p> <h2 id="_5-1-函数"><a href="#_5-1-函数" class="header-anchor">#</a> 5.1 函数</h2> <p>首先来看一下C语言的入门程序，编写demo.c文件如下：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, World! \n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们看到调用了printf函数，通过print的名字可以知道是打印输出HelloWorld字符串的意思，那么思考一下C语言本身是否可以完成输出字符串的操作？首先来看一下网站的大体架构：</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image4.6c7fabde.png" alt="C语言"></p> <p>网站访问时，通过约定的url来访问，一般采用Restful形式，如/user/login、/user/logout等等。系统中的程序也是如此：</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image5.ceff2f3a.png" alt="C语言"></p> <p>它们非常相似，只不过操作系统的命名是以sys开头的。那么我们写的C程序是Ring 3级别的，它是不可以执行一些IO操作的，或是GDT表操作以及与自身特权级不符的操作的，这些超出自身特权级范围的操作，程序需要递交请求到操作系统，由操作系统来执行。所以很容易能知道printf的操作，它的底层一定是和操作系统做了交互，然后由操作系统将HelloWorld输出在屏幕上。</p> <h3 id="_5-1-1-汇编call、ret、leave指令执行过程"><a href="#_5-1-1-汇编call、ret、leave指令执行过程" class="header-anchor">#</a> 5.1.1 汇编call、ret、leave指令执行过程</h3> <p>汇编代码中的call和ret前面介绍过，是用于代码段与代码段之间调用和返回的，但它们具体是如何工作的呢？让我们来分析一下，我们用代码段A和代码段B来模拟，代码段A调用代码段B步骤如下：</p> <ul><li><strong>开辟代码段A的栈帧。初始化时栈底BP=栈顶SP，填充代码段A的数据后，栈底BP不变，栈顶SP扩张。</strong></li></ul> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image6.c484205a.png" alt="C语言"></p> <ul><li><strong>代码段A调用代码段B。存储call指令的下一条指令的地址，开辟栈帧将BP中的值压栈，然后栈顶=栈底，栈顶继续扩张存储代码段B的数据。</strong></li></ul> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image7.2b42d69e.png" alt="C语言"></p> <ul><li><strong>代码段B调用完毕后，执行leave指令的第一个动作：将栈底BP的值赋给栈顶SP，此时栈底BP=栈顶SP。执行leave指令的第二个动作：弹出BP，使BP返回到代码段A的栈帧的栈底，完成栈帧的销毁。</strong></li></ul> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image8.a1b87f5e.png" alt="C语言"></p> <ul><li><strong>执行ret指令，返回到call指令的下一条指令继续执行之后的代码，将保存的返回地址弹出放入IP寄存器，此时IP指令地址寄存器已经跳转到call指令之后的指令上。</strong></li></ul> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image9.8fa3fe20.png" alt="C语言"></p> <h3 id="_5-1-2-helloworld程序的汇编代码"><a href="#_5-1-2-helloworld程序的汇编代码" class="header-anchor">#</a> 5.1.2 HelloWorld程序的汇编代码</h3> <p>接下来使用gcc编译器来编译<code>demo.c</code>文件，让我们来看一下HelloWorld程序的汇编代码。使用<code>gcc --help</code>可以查看gcc的帮助文档。执行<code>gcc -m32 -S demo.c</code>编译出demo.s文件，这个.s文件就是汇编代码片段，-m32是以32位机器来编译出汇编代码。如果你是64位机，缺少32位库函数的话，执行<code>yum -y install glibc*.i686</code>来解决。</p> <p>执行<code>cat demo.s</code>即可查看汇编代码，将HelloWorld程序的汇编代码精简后如下：</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image10.5402294b.png" alt="C语言"></p> <p>通过查看HelloWorld程序的汇编代码，我们知道了使用<code>.section .rodata</code>来表示只读数据节。使用<code>.text</code>来表示代码段。使用<code>.globl</code>来表示全局的符号。使用名称+冒号的方式来做一个标号(如.LC0:)。使用eax寄存器来保存返回值。使用<code>()</code>来操作地址等等。</p> <h3 id="_5-1-3-数据的传递"><a href="#_5-1-3-数据的传递" class="header-anchor">#</a> 5.1.3 数据的传递</h3> <p>那么思考一下，在C语言中传递参数是如何传递的？有这样一段代码：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> a<span class="token operator">+</span>b<span class="token operator">+</span>c<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们分别使用32位和64位的方式编译这段代码，汇编如下：</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image11.9c215fcf.png" alt="C语言"></p> <p>注意到汇编代码中，根据之前了解的Intel的寄存器命名规则，我们知道r开头是64位机，e开头是32位机，但是为什么64位机编译出来的汇编代码中，即有r开头的寄存器，又有e开头的寄存器呢？是因为通用寄存器在使用时会根据数据的大小来决定使用高32位还是低32位，所以64位汇编代码中会有e开头的寄存器。</p> <p>通过对比32位和64位汇编代码，我们发现参数是直接嵌在指令中的，也就是立即数。在64位的情况下，传递参数是使用寄存器来传递的，如<code>movl $3, %edx</code>、<code>movl $2, %esi</code>、<code>movl $1, %edi</code>。在32位的情况下，传递参数是使用栈来传递的，如<code>pushl $3</code>、<code>pushl $2</code>、<code>pushl $1</code>。</p> <p>我们再看一个例子，如果返回值是一个结构体，那么这个返回值是如何传递呢？<code>demo.c</code>代码如下：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token comment">//结构体，str结构体合计占26byte，需要内存对齐，对齐到32byte</span>
<span class="token keyword">struct</span> <span class="token class-name">str</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> a<span class="token punctuation">;</span> 			<span class="token comment">//占4byte</span>
    <span class="token keyword">int</span> b<span class="token punctuation">;</span>			<span class="token comment">//占4byte</span>
    <span class="token keyword">long</span> c<span class="token punctuation">;</span>			<span class="token comment">//占8byte(64位)</span>
    <span class="token keyword">char</span> ch<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>	<span class="token comment">//占10byte</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>	

<span class="token comment">//定义一个函数，这个函数返回了一个结构体</span>
<span class="token keyword">struct</span> <span class="token class-name">str</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">struct</span> <span class="token class-name">str</span> s <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;123456789&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">struct</span> <span class="token class-name">s</span> <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>执行<code>gcc -S -fno-asynchronous-unwind-tables demo.c</code>编译出demo.s汇编文件，加入<code>-fno-asynchronous-unwind-tables</code>是为了禁止生成.cfi代码，demo.s汇编代码如下：</p> <div class="language- extra-class"><pre class="language-text"><code>        .file   &quot;demo.c&quot;
        .text
        .globl  func
        .type   func, @function
//func函数
func:
    	//开辟func栈帧
        pushq   %rbp
    	//栈帧初始化，栈顶=栈底
        movq    %rsp, %rbp
    	//此时rid寄存器，保存着32byte空间的首地址，又存放到了func函数的栈帧上
        movq    %rdi, -40(%rbp)
        //存放数据1
        movl    $1, -32(%rbp)
        //存放数据2    
        movl    $2, -28(%rbp)
        //存放数据3
        movq    $3, -24(%rbp)
        //通过rax寄存器中转存放char数组
        movabsq $4050765991979987505, %rax
        movq    %rax, -16(%rbp)
        //$57是什么？经过查询ASCII码表发现，57表示数字9
        //那么看我们代码中有什么和数字9有关呢？那就是char数组长度嘛
        //所以我们知道，这里是对数组长度在栈帧中存储
        movw    $57, -8(%rbp)
        /* ------------------------ 以上都是对结构体做存储 ------------------------- */    

        /* ---------------------- 以下就是返回前的参数拷贝操作 ---------------------- */
        movq    -40(%rbp), %rcx
        movq    -32(%rbp), %rax
        movq    -24(%rbp), %rdx
        movq    %rax, (%rcx)
        movq    %rdx, 8(%rcx)
        movq    -16(%rbp), %rax
        movq    -8(%rbp), %rdx
        movq    %rax, 16(%rcx)
        movq    %rdx, 24(%rcx)
        movq    -40(%rbp), %rax
        popq    %rbp
        ret
//main函数
main:
        //开辟main栈帧
        pushq   %rbp
    	//栈帧初始化，栈顶=栈底
        movq    %rsp, %rbp
    	//开辟32byte的空间
        subq    $32, %rsp
    	//将开辟的32byte空间的地址，存放到rax寄存器中
        leaq    -32(%rbp), %rax
    	//将rax寄存器中的地址(32byte空间的地址)，存放到rdi寄存器中
    	//此时rdi寄存器中存放了一个32byte空间的首地址
        movq    %rax, %rdi
        movl    $0, %eax
    	//调用func函数
        call    func
    	//main函数的返回值
        movl    $1, %eax
    	//销毁栈帧
        leave
    	//返回
        ret
</code></pre></div><p>通过查看汇编代码，我们发现对于结构体的传递，它是通过栈来传递，其实就是将地址传来传去的，那么可以得出结论，传递数据的方式无非就是两种：</p> <ol><li>通过寄存器传递。</li> <li>通过栈传递。当使用寄存器传递受到大小限制或寄存器不够用时，则只能使用栈来传递额外的参数。</li></ol> <p>至此我们发现，C语言其实就是对汇编语言的抽象，C语言的函数封装了底层的调用过程，封装了参数传递的过程，封装了返回的过程：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, World! \n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

返回值 汇编中的标号<span class="token punctuation">(</span>如<span class="token punctuation">.</span>LC0<span class="token punctuation">)</span> 参数<span class="token punctuation">{</span>
	指令
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_5-2-extern关键字"><a href="#_5-2-extern关键字" class="header-anchor">#</a> 5.2 extern关键字</h2> <p>我们编写代码时，会编写多个代码文件，当我们在一个文件中想要依赖其他文件中定义的数据时，我们应该怎么做呢？比如现有如下<code>demo.c</code>和<code>data.c</code>文件，<code>demo.c</code>中需要用到<code>data.c</code>中的数据：</p> <details class="custom-block details"><summary>demo.c</summary> <div class="language-js extra-class"><pre class="language-js"><code>#include <span class="token operator">&lt;</span>stdio<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
int <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">void</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    int a <span class="token operator">=</span> data <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></details> <details class="custom-block details"><summary>data.c</summary> <div class="language-js extra-class"><pre class="language-js"><code>int data <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
</code></pre></div></details> <p>在<code>demo.c</code>的main函数中，调用了data这个数据，而data这个数据是存放在<code>data.c</code>文件中的，此时通过<code>gcc -S demo.c</code>编译demo.c文件，就会报出data未声明的错误，因为编译器根本不知道这个data是什么。</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image12.22155926.png" alt="C语言"></p> <p>虽然编译时，不会涉及到具体的值，但要高速编译器，这个data是来自于外部的，在其他文件定义了。所以需要extern关键字来告诉编译器这个data保存在外部，以及它的类型是什么。因为生成指令时，需要知道数据的类型，才能开辟对应大小的内存空间，比如int类型开辟4byte，long类型开辟8byte等。而我们需要在其他文件中找到对应的data，就需要满足名字一样、类型一样，修改demo.c文件，添加<code>extern int data;</code>：</p> <details class="custom-block details"><summary>data.c</summary> <div class="language-js extra-class"><pre class="language-js"><code>#include <span class="token operator">&lt;</span>stdio<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
<span class="token comment">//此时表示data定义在外部</span>
extern int data<span class="token punctuation">;</span>
int <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">void</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    int a <span class="token operator">=</span> data <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></details> <p>再次执行<code>gcc -S demo.c</code>编译通过生成<code>demo.s</code>汇编文件，汇编代码精简后如下：</p> <details class="custom-block details"><summary>demo.s AT&amp;T汇编</summary> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">main</span><span class="token operator">:</span>
        pushq   <span class="token operator">%</span>rbp
        movq    <span class="token operator">%</span>rsp<span class="token punctuation">,</span> <span class="token operator">%</span>rbp
        movl    <span class="token function">data</span><span class="token punctuation">(</span><span class="token operator">%</span>rip<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">%</span>eax
        addl    $1<span class="token punctuation">,</span> <span class="token operator">%</span>eax
        movl    <span class="token operator">%</span>eax<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">(</span><span class="token operator">%</span>rbp<span class="token punctuation">)</span>
        movl    $1<span class="token punctuation">,</span> <span class="token operator">%</span>eax
        popq    <span class="token operator">%</span>rbp
        ret
</code></pre></div></details> <p>可以看到movl data(%rip), %eax来移动data的地址。但这只是编译通过了，如果想执行，就需要找到这个data。那么我们将data.c文件编译，执行gcc -S data.c编译出data.s汇编代码：</p> <details class="custom-block details"><summary>data.s AT&amp;T汇编</summary> <div class="language-js extra-class"><pre class="language-js"><code>        <span class="token punctuation">.</span>file   <span class="token string">&quot;data.c&quot;</span>
        <span class="token punctuation">.</span>text
        <span class="token punctuation">.</span>globl  data
      	<span class="token comment">//.data表示数据段</span>
        <span class="token punctuation">.</span>data
        <span class="token punctuation">.</span>align <span class="token number">4</span>
        <span class="token punctuation">.</span>type   data<span class="token punctuation">,</span> @object
        <span class="token punctuation">.</span>size   data<span class="token punctuation">,</span> <span class="token number">4</span>
<span class="token literal-property property">data</span><span class="token operator">:</span>
        <span class="token punctuation">.</span>long   <span class="token number">5</span>
        <span class="token punctuation">.</span>ident  <span class="token string">&quot;GCC: (GNU) 8.5.0 20210514 (Red Hat 8.5.0-4)&quot;</span>
        <span class="token punctuation">.</span>section        <span class="token punctuation">.</span>note<span class="token punctuation">.</span><span class="token constant">GNU</span><span class="token operator">-</span>stack<span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>@progbits
</code></pre></div></details> <p>现在两个C文件的汇编代码都有了，分别是<code>demo.s</code>和<code>data.s</code>，想要执行，能想到的最简单的方式，就是将这两个汇编代码整合，也就是将<code>data.s</code>的汇编原方不动的粘贴到<code>demo.s</code>汇编代码中，如下：</p> <details class="custom-block details"><summary>demo.s AT&amp;T汇编</summary> <div class="language-js extra-class"><pre class="language-js"><code>        <span class="token punctuation">.</span>file   <span class="token string">&quot;demo.c&quot;</span>
      	<span class="token comment">//********此处将data.s粘贴在demo.s文件中</span>
        <span class="token punctuation">.</span>globl  data
        <span class="token punctuation">.</span>data
        <span class="token punctuation">.</span>align <span class="token number">4</span>
        <span class="token punctuation">.</span>type   data<span class="token punctuation">,</span> @object
        <span class="token punctuation">.</span>size   data<span class="token punctuation">,</span> <span class="token number">4</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span>
                <span class="token punctuation">.</span>long   <span class="token number">5</span>
      	<span class="token comment">//********demo.s汇编代码粘贴结束</span>
        <span class="token punctuation">.</span>text
        <span class="token punctuation">.</span>globl  main
        <span class="token punctuation">.</span>type   main<span class="token punctuation">,</span> @<span class="token keyword">function</span>
<span class="token literal-property property">main</span><span class="token operator">:</span>
<span class="token punctuation">.</span><span class="token constant">LFB0</span><span class="token operator">:</span>
        <span class="token punctuation">.</span>cfi_startproc
        pushq   <span class="token operator">%</span>rbp
        <span class="token punctuation">.</span>cfi_def_cfa_offset <span class="token number">16</span>
        <span class="token punctuation">.</span>cfi_offset <span class="token number">6</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">16</span>
        movq    <span class="token operator">%</span>rsp<span class="token punctuation">,</span> <span class="token operator">%</span>rbp
        <span class="token punctuation">.</span>cfi_def_cfa_register <span class="token number">6</span>
        movl    <span class="token function">data</span><span class="token punctuation">(</span><span class="token operator">%</span>rip<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">%</span>eax
        addl    $1<span class="token punctuation">,</span> <span class="token operator">%</span>eax
        movl    <span class="token operator">%</span>eax<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">(</span><span class="token operator">%</span>rbp<span class="token punctuation">)</span>
        movl    $1<span class="token punctuation">,</span> <span class="token operator">%</span>eax
        popq    <span class="token operator">%</span>rbp
        <span class="token punctuation">.</span>cfi_def_cfa <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span>
        ret
        <span class="token punctuation">.</span>cfi_endproc
<span class="token punctuation">.</span><span class="token constant">LFE0</span><span class="token operator">:</span>
        <span class="token punctuation">.</span>size   main<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token operator">-</span>main
        <span class="token punctuation">.</span>ident  <span class="token string">&quot;GCC: (GNU) 8.5.0 20210514 (Red Hat 8.5.0-4)&quot;</span>
        <span class="token punctuation">.</span>section        <span class="token punctuation">.</span>note<span class="token punctuation">.</span><span class="token constant">GNU</span><span class="token operator">-</span>stack<span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>@progbits
</code></pre></div></details> <p>执行<code>gcc demo.s</code>，此时生成<code>a.out</code>可执行文件，程序就可以正常运行了。当然gcc编译器其实已经为我们提供了更简便的方式，将两个汇编文件恢复原样，执行<code>gcc demo.s data.s</code>，就可以将两个文件组合，同样可以生成<code>a.out</code>可执行文件，这就是extern关键字的作用。那么进一步可以得出结论，我们只需要定义数据段和代码段就可以了，gcc会自动将它们整合在一起。</p> <h2 id="_5-3-static关键字"><a href="#_5-3-static关键字" class="header-anchor">#</a> 5.3 static关键字</h2> <p>有时我们想某个C文件中的数据或函数，只在当前这个文件中使用，那么如何做到与其他文件中的数据和函数的隔离呢？先来看一段C代码，<code>demo.c</code>文件如下：</p> <div class="language- extra-class"><pre class="language-text"><code>#include &lt;stdio.h&gt;

int data = 5;
int main(void){
    int a = data + 1;
    return 1;
}
</code></pre></div><p>demo.c文件中定义了一个<code>int data = 5;</code>的数据，执行<code>gcc -S demo.c</code>编译出<code>demo.s</code>汇编文件如下：</p> <details class="custom-block details"><summary>demo.s AT&amp;T汇编</summary> <div class="language-js extra-class"><pre class="language-js"><code>        <span class="token punctuation">.</span>file   <span class="token string">&quot;demo.c&quot;</span>
        <span class="token punctuation">.</span>text
        <span class="token punctuation">.</span>globl  data
        <span class="token punctuation">.</span>data
        <span class="token punctuation">.</span>align <span class="token number">4</span>
        <span class="token punctuation">.</span>type   data<span class="token punctuation">,</span> @object
        <span class="token punctuation">.</span>size   data<span class="token punctuation">,</span> <span class="token number">4</span>
<span class="token literal-property property">data</span><span class="token operator">:</span>
        <span class="token punctuation">.</span>long   <span class="token number">5</span>
        <span class="token punctuation">.</span>text
        <span class="token punctuation">.</span>globl  main
        <span class="token punctuation">.</span>type   main<span class="token punctuation">,</span> @<span class="token keyword">function</span>
<span class="token literal-property property">main</span><span class="token operator">:</span>
<span class="token punctuation">.</span><span class="token constant">LFB0</span><span class="token operator">:</span>
        pushq   <span class="token operator">%</span>rbp
        movq    <span class="token operator">%</span>rsp<span class="token punctuation">,</span> <span class="token operator">%</span>rbp
        movl    <span class="token function">data</span><span class="token punctuation">(</span><span class="token operator">%</span>rip<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">%</span>eax
        addl    $1<span class="token punctuation">,</span> <span class="token operator">%</span>eax
        movl    <span class="token operator">%</span>eax<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">(</span><span class="token operator">%</span>rbp<span class="token punctuation">)</span>
        movl    $1<span class="token punctuation">,</span> <span class="token operator">%</span>eax
        popq    <span class="token operator">%</span>rbp
        ret
</code></pre></div></details> <p>通过查看汇编代码，发现通过<code>.globl data</code>声明了一个全局的data符号，此时这个data的数据是可以在其他文件中使用的，通过<code>.globl</code>标识将当前文件中的数据和函数导出，才能让其他文件看到当前文件中定义的数据和函数。而且前面我们在测试extern关键字时也已经验证过了，是可以通过<code>extern int data;</code>的方式告诉编译器当前文件中所使用的data来自于外部的。</p> <p>那么此时我们不想将这个数据让外部使用，只想在当前文件中使用，如何实现隔离？这时就可以使用static关键字就可以做到，修改<code>demo.c</code>代码：</p> <div class="language- extra-class"><pre class="language-text"><code>#include &lt;stdio.h&gt;

static int data = 5;
int main(void){
    int a = data + 1;
    return 1;
}
</code></pre></div><p>代码中使用static关键字修饰了变量，再次执行<code>gcc -S demo.c</code>编译出<code>demo.s</code>汇编文件如下：</p> <details class="custom-block details"><summary>demo.s AT&amp;T汇编</summary> <div class="language-js extra-class"><pre class="language-js"><code>        <span class="token punctuation">.</span>file   <span class="token string">&quot;demo.c&quot;</span>
        <span class="token punctuation">.</span>text
        <span class="token punctuation">.</span>data
        <span class="token punctuation">.</span>align <span class="token number">4</span>
        <span class="token punctuation">.</span>type   data<span class="token punctuation">,</span> @object
        <span class="token punctuation">.</span>size   data<span class="token punctuation">,</span> <span class="token number">4</span>
<span class="token literal-property property">data</span><span class="token operator">:</span>
        <span class="token punctuation">.</span>long   <span class="token number">5</span>
        <span class="token punctuation">.</span>text
        <span class="token punctuation">.</span>globl  main
        <span class="token punctuation">.</span>type   main<span class="token punctuation">,</span> @<span class="token keyword">function</span>
<span class="token literal-property property">main</span><span class="token operator">:</span>
<span class="token punctuation">.</span><span class="token constant">LFB0</span><span class="token operator">:</span>
        pushq   <span class="token operator">%</span>rbp
        movq    <span class="token operator">%</span>rsp<span class="token punctuation">,</span> <span class="token operator">%</span>rbp
        movl    <span class="token function">data</span><span class="token punctuation">(</span><span class="token operator">%</span>rip<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">%</span>eax
        addl    $1<span class="token punctuation">,</span> <span class="token operator">%</span>eax
        movl    <span class="token operator">%</span>eax<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">(</span><span class="token operator">%</span>rbp<span class="token punctuation">)</span>
        movl    $1<span class="token punctuation">,</span> <span class="token operator">%</span>eax
        popq    <span class="token operator">%</span>rbp
        ret
</code></pre></div></details> <p>再次查看汇编代码我们发现，之前声明的<code>.globl data</code>的全局符号消失了，data变成了当前文件中的数据段，此时这个data将不可再被外部文件所使用的。那么static关键字的作用也很明显了，C语言中使用static关键字来抽象<code>.globl</code>，通过static关键字来屏蔽<code>.globl</code>。static修饰的数据一般为静态数据，修饰的函数一般为静态函数，还记得之前学习过的数据段吗？这些静态数据是编译期就存在的数据，都会存放在数据段中，使用时通过地址来操作它们。</p> <p>经过上面的验证，发现statci关键字修饰全局变量，会使变量在当前文件私有，那么修饰全局函数也是同样的道理，会使函数在当前文件私有。那再来看static关键字的另一种写法，用它来修饰局部变量：</p> <div class="language- extra-class"><pre class="language-text"><code>#include &lt;stdio.h&gt;

int func() {
    static int a = 1;
    return a++;
}
int main(void) {
    printf(&quot;%d\n&quot;, func());		// -----&gt; 输出 1
    printf(&quot;%d\n&quot;, func());		// -----&gt; 输出 2
}
</code></pre></div><p>将static关键字应用在局部变量中，变量a则不会分配在栈上了，而是分配在数据段，<code>demo.c</code>的汇编代码如下：</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image13.0057b5bb.png" alt="C语言"></p> <h2 id="_5-4-指针"><a href="#_5-4-指针" class="header-anchor">#</a> 5.4 指针</h2> <p>前面已经看过很多C代码和汇编代码了，当我们再看到函数中<code>int a = 1;</code>的代码时，第一时间就能想到有一个int类型的数据，会在栈中开辟4byte的空间。当看到<code>sum(1)</code>时，第一时间就能想到这个1是一个立即数。重点是慢慢培养出这种思维习惯。</p> <p>C语言中一个比较难以理解的概念就是指针，此时有这样一个需求，main函数中有一个int类型的shareData变量，在调用sum函数时将shareData的地址传递给sum函数，然后在sum函数中对shareData进行修改，代码如下：</p> <div class="language- extra-class"><pre class="language-text"><code>#include &lt;stdio.h&gt;

//参数类型为int，表示指向内存单元的是4byte的数据，*p抽象了汇编中的()
void sum(int *p) {
    *p = 3;
}

int main(void) {
    //声明int类型的shareData变量
    //shareData在main的栈帧中，传递到sum，完成共享
    int shareData = 1;
    //传递shareData的地址，使用&amp;符号表示取shareData的地址，&amp;来抽象汇编代码的lea取地址指令
    sum(&amp;shareData);
    return 1;
}
</code></pre></div><p>代码中有3处疑问，分别是<code>*p</code>、<code>&amp;</code>和<code>lea</code>指令：</p> <ul><li>*p：代码中使用<em>p来接收参数，表示一个指针变量。汇编中使用()来接收一个地址，C语言中使用</em>p来接收一个地址，所以可以说<em>p是抽象了汇编中的()。代码中</em>p接收参数以后，这个变量p将有2层含义：p是shareData的地址(指针变量)，<em>p解引用则操作了真实的数据，即</em>p = 3就是修改shareData = 3。</li> <li>&amp;：C语言中，使用&amp;符号来取地址。来抽象汇编代码的lea指令。</li> <li>lea指令：我们当然不需要死记硬背汇编代码中所有的指令，因为这就像汉语虽然是我们的母语，但我们也不能去记住所有的汉字，遇到不会的查字典就可以了，指令也是一样，Intel手册就像是一本字典，在Intel手册第2卷第3节3.2详细介绍了lea(Load Effective Address)指令。</li></ul> <p>此时大概能明白什么是指针了，指针就是有一个地址，这个地址指向了一个数据，这种指向的关系就是指针。明白了这个概念，在面对二级指针、三级指针的时候，无非就是多加了几个<code>*</code>号而已，如<code>*p</code>、<code>**p</code>等等。如果还是不明白，可能下面这张图会更容易理解：</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image14.158050ea.png" alt="C语言"></p> <h3 id="_5-4-1-指针的应用"><a href="#_5-4-1-指针的应用" class="header-anchor">#</a> 5.4.1 指针的应用</h3> <p>首先定义一个数组，让我们猜测一下它做了什么操作，<code>demo.c</code>代码如下：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> b <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> c <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>猜测如下：</p> <ol><li>有一个int类型的arr数组，数组中有3个元素，会在main的栈帧中开辟12byte的空间</li> <li>变量a、b、c，也都是int类型的，也会开辟12byte的空间。那么它们总共会占用24byte的空间</li></ol> <p>猜测的是否正确，让我们验证一下。执行<code>gcc -S -m32 demo.c</code>编译生成demo.s文件如下：</p> <details class="custom-block details"><summary>demo.s AT&amp;T汇编</summary> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">main</span><span class="token operator">:</span>
        <span class="token comment">//每个代码段的前面都会有这个开辟栈帧的操作</span>
        pushl   <span class="token operator">%</span>ebp
        <span class="token comment">//初始化栈帧的栈顶=栈底</span>
        movl    <span class="token operator">%</span>esp<span class="token punctuation">,</span> <span class="token operator">%</span>ebp
    	<span class="token comment">//开辟了32byte的空间，为什么不是24byte？因为内存对齐，暂时可以先忽略</span>
        subl    $32<span class="token punctuation">,</span> <span class="token operator">%</span>esp
    	<span class="token comment">//放入数据1</span>
        movl    $1<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">24</span><span class="token punctuation">(</span><span class="token operator">%</span>ebp<span class="token punctuation">)</span>
        <span class="token comment">//放入数据2，此处推了4byte</span>
        movl    $2<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">(</span><span class="token operator">%</span>ebp<span class="token punctuation">)</span>
        <span class="token comment">//放入数据3，此处推了4byte</span>
        movl    $3<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">(</span><span class="token operator">%</span>ebp<span class="token punctuation">)</span>
            
        <span class="token comment">//Intel规定，不允许再两个内存中互相传递数据，所以通过eax寄存器中转</span>
        <span class="token comment">//-24(%ebp)为数据1的地址</span>
        movl    <span class="token operator">-</span><span class="token number">24</span><span class="token punctuation">(</span><span class="token operator">%</span>ebp<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">%</span>eax
        movl    <span class="token operator">%</span>eax<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">(</span><span class="token operator">%</span>ebp<span class="token punctuation">)</span>
            
        <span class="token comment">//-20(%ebp)为数据2的地址</span>
        movl    <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">(</span><span class="token operator">%</span>ebp<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">%</span>eax
        movl    <span class="token operator">%</span>eax<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">(</span><span class="token operator">%</span>ebp<span class="token punctuation">)</span>
            
        <span class="token comment">//-16(%ebp)为数据3的地址</span>
        movl    <span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">(</span><span class="token operator">%</span>ebp<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">%</span>eax
        movl    <span class="token operator">%</span>eax<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">(</span><span class="token operator">%</span>ebp<span class="token punctuation">)</span>
            
        <span class="token comment">//返回</span>
        movl    $1<span class="token punctuation">,</span> <span class="token operator">%</span>eax
        leave
        ret
</code></pre></div></details> <p>通过观察<code>demo.c</code>文件和它的汇编文件<code>demo.s</code>，我们的猜测基本正确，可以发现<code>arr[n]</code>的操作，等价于取地址中的值，数组就是指针的语法糖，最终都是操作地址，当时用<code>arr[n]</code>操作数组时，与使用指针操作数据一样，底层汇编代码都是<code>()</code>来操作地址。</p> <h3 id="_5-4-2-二级指针"><a href="#_5-4-2-二级指针" class="header-anchor">#</a> 5.4.2 二级指针</h3> <p>二级指针无非就是指针套指针，就像是一个二维数组。为什么使用二级指针呢？因为有时内存不连续，比如链表这种数据结构，所以使用指针将它们连接形成一个二级指针。</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image15.10563e39.png" alt="C语言"></p> <h2 id="_5-5-sizeof-函数"><a href="#_5-5-sizeof-函数" class="header-anchor">#</a> 5.5 sizeof()函数</h2> <p>C语言中的sizeof()函数，用于计算占用的内存空间大小，请看如下代码：</p> <div class="language- extra-class"><pre class="language-text"><code>#include &lt;stdio.h&gt;

//定义了一个结构体
struct test {
    int a;
	int b;
	char str[];
};
int main(void){
    printf(&quot;%d\n&quot;, sizeof(struct Str));		// -----&gt;输出8
    return 1;
}
</code></pre></div><p>为什么输出的是8呢？因为int类型的a占了4byte，b占了4byte，而char类型的数组，是ANSI C的特性-&gt;可变数组长度，而sizeof()函数的结果是编译期就已经计算好的大小，而这个数组在编译期并没有使用，所以不会参与到sizeof()函数的计算中去，sizeof()函数的计算不会包含任何指令进去，比如下面这段代码：</p> <div class="language- extra-class"><pre class="language-text"><code>#include &lt;stdio.h&gt;

int main(void){
    int a = 1;
    printf(&quot;%d\n&quot;, sizeof(a++));	// -----&gt; 输出 4，占用4byte
    printf(&quot;%d\n&quot;, a);				// -----&gt; 输出 1
    return 1;
}
</code></pre></div><p>可以看到变量a虽然在sizeof()函数中写的是a++，但最终a的值还是1，因为sizeof()就是计算占用的总空间大小，不会包含任何的指令，因为这些大小是在编译期计算的，而编译器在执行时是不会执行指令的。那是否可以自己写一个sizeof()函数呢？</p> <h3 id="_5-5-1-size-t关键字"><a href="#_5-5-1-size-t关键字" class="header-anchor">#</a> 5.5.1 size_t关键字</h3> <p>手写一个sizeof()函数，首先是通过&amp;取当前数据的地址，然后直接对地址进行计算，但此时需要考虑一个问题，就是当前存放的地址值是32位还是64位，这个不确定，为了保证写的代码具有可移植性，抽出一个东西在使用时由当前平台的位数来初始化，这个关键字就是size_t，使用size_t来修饰一个变量，它能够在编译时将size_t修饰的变量，根据当前机器的位数进行初始化。</p> <blockquote><p>注：C语言中的long类型在32位机中占4byte(32bit)，在64位机中占8byte(64bit)。</p></blockquote> <details class="custom-block details"><summary>手写sizeof()函数</summary> <div class="language- extra-class"><pre class="language-text"><code>#include &lt;stdio.h&gt;

int main(void) {
    int a = 1;
    //取 a 的地址，强转为 size_t 类型
	size_t p = (size_t) &amp;a;
    //对 a 的地址 +1，此处的+1是对地址的操作。int类型在内存中就是+4byte
	size_t o = (size_t) ((&amp;a) + 1);
	printf(&quot;%d\n&quot;, o-p);		// -----&gt; 输出 4，表示4byte
}
</code></pre></div></details> <p>这样我们使用size_t关键字，就等于是手动实现了一个sizeof()函数。</p> <h2 id="_5-6-字符串的结尾"><a href="#_5-6-字符串的结尾" class="header-anchor">#</a> 5.6 字符串的结尾</h2> <p>在C语言中创建字符串，就是使用一个char类型的数组或char类型的指针来创建的。创建字符串时，在一个连续的内存空间中如何知道字符串的结尾呢？C语言中使用&quot;\0&quot;来表示字符串的结尾，因为在一个连续的内存空间中不标识出结束的位置，遍历的时候将会一直循环下去，C语言中会在字符串的末尾加上&quot;\0&quot;，用于标识字符串的结尾。</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image16.f6df11ec.png" alt="C语言"></p> <p>此时你可能会思考，如果在字符串中间，自己写了一个&quot;\0&quot;会怎么样呢？答案是会以你中间写的那个&quot;\0&quot;作为结尾。</p> <div class="language- extra-class"><pre class="language-text"><code>#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

int main(void) {
    printf(&quot;%d\n&quot;, sizeof(&quot;hello&quot;));   	// -----&gt; 输出6
    printf(&quot;%d\n&quot;, strlen(&quot;hel\0o&quot;));   // -----&gt; 输出3
	printf(&quot;%d\n&quot;, strlen(&quot;hello&quot;));   	// -----&gt; 输出5
    return 1;
}
</code></pre></div><p>代码中使用sizeof()来计算&quot;hello&quot;字符串在内存中占用的大小为6byte，就是因为在末尾加上了&quot;\0&quot;的原因。而strlen()函数则是计算字符串的长度，strlen()函数计算时不包含&quot;\0&quot;，所以不管是你自己在字符串中写了&quot;\0&quot;，还是默认在结尾加上的&quot;\0&quot;，就会认为是字符串结尾。</p> <h2 id="_5-7-宏定义-宏处理"><a href="#_5-7-宏定义-宏处理" class="header-anchor">#</a> 5.7 宏定义/宏处理</h2> <p>前面已经看过很多C代码了，发现在每个<code>.c</code>文件的最上边都有一个<code>#include &lt;stdio.h&gt;</code>，比如<code>demo.c</code>这段代码：</p> <div class="language- extra-class"><pre class="language-text"><code>#include &lt;stdio.h&gt;

int main(void){
    printf(&quot;Hello, World! \n&quot;);
    return 1;
}
</code></pre></div><p>我们代码中调用的printf()函数，程序怎么能知道printf()函数在哪里呢？前面了解过使用extern关键字可以声明外部函数或数据，那此时思考一个问题，假如我们的文件中需要用到1000个外部的函数或数据，难道要写1000行的extern来声明吗？这明显是很笨的写法，所以我们就可以将这些个外部函数和数据，封装在<code>.h</code>头文件中，将这些需要extern声明的内容单独挪出来放在<code>.h</code>头文件中。不过编译器是不认识<code>#include</code>的，所以要在编译器编译之前，将<code>.h</code>头文件还原到当前文件中，这个处理的过程就叫做宏处理。而由于这个宏处理是在编译器编译之前进行的，所以宏处理也称为预处理。</p> <p>我们执行<code>gcc -E demo.c -o demo.i</code>预处理命令，<code>-E</code>表示进行 将demo.c文件放进去表示该文件做预处理，<code>-o demo.i</code>表示将输出结果放入到<code>demo.i</code>文件中，<code>.i</code>就是宏处理文件，可以通过<code>cat demo.i</code>查看，<code>demo.i</code>文件如下：</p> <div class="language- extra-class"><pre class="language-text"><code>...... 省略内容

extern void funlockfile (FILE *__stream) __attribute__ ((__nothrow__ , __leaf__));
# 864 &quot;/usr/include/stdio.h&quot; 3 4
extern int __uflow (FILE *);
extern int __overflow (FILE *, int);
# 879 &quot;/usr/include/stdio.h&quot; 3 4

# 2 &quot;demo.c&quot; 2

# 3 &quot;demo.c&quot;
int main(void) {
	printf(&quot;%d\n&quot;, &quot;HelloWorld!\n&quot;);
	return 1;
}
</code></pre></div><p>可以看到里面有很多extern关键字的声明，当然不止有extern声明，还有一些其他的声明，其实这个处理就是将<code>.h</code>头文件原方不动的展开，然后和<code>demo.c</code>文件合并生成<code>demo.i</code>文件而已。有了<code>.i</code>预处理文件，下一步就是编译了，执行<code>gcc -S demo.i</code>编译，直接编译<code>.i</code>文件，生成<code>demo.s</code>汇编文件：</p> <div class="language- extra-class"><pre class="language-text"><code>        .file   &quot;demo.c&quot;
        .text
        .section        .rodata
.LC0:
        .string &quot;HelloWorld!\n&quot;
.LC1:
        .string &quot;%d\n&quot;
        .text
        .globl  main
        .type   main, @function
main:
.LFB0:
        pushq   %rbp
        movq    %rsp, %rbp
        movl    $.LC0, %esi
        movl    $.LC1, %edi
        movl    $0, %eax
        call    printf
        movl    $1, %eax
        popq    %rbp
        ret
.LFE0:
        .size   main, .-main
        .ident  &quot;GCC: (GNU) 8.5.0 20210514 (Red Hat 8.5.0-4)&quot;
        .section        .note.GNU-stack,&quot;&quot;,@progbits
</code></pre></div><p>执行后编译出<code>.s</code>汇编文件，只不过<code>.i</code>文件中的很多内容不见了，这就说明编译器抛弃了所有不需要的内容，只保留了需要的内容，如<code>printf</code>函数。至此我们就明白了<code>.h</code>头文件的宏处理都做了什么操作。</p> <h2 id="_5-8-与运算、或运算、异或运算"><a href="#_5-8-与运算、或运算、异或运算" class="header-anchor">#</a> 5.8 与运算、或运算、异或运算</h2> <p><strong>与运算</strong>：有0则0。2个二进制数做运算，不管是0还是1，只要有0，结果就是0。它的目的是二进制截断。为什么叫二进制截断？因为在二进制数中，如果想保留自己的高几位，那就和自己的高几位做与运算，如果想保留自己的低几位，那就和自己的低几位做与运算，举个例子：</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image17.5f4441ba.png" alt="C语言"></p> <p><strong>或运算</strong>：有1则1。2个二进制数做运算，不管是0还是1，只要有1，结果就是1。它的目的是二进制组合。为什么叫二进制组合？因为在二进制数中，如果想让2个二进制数合并，那就做或运算。举个例子：</p> <p><img src="data:image/png;base64,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" alt="C语言"></p> <p><strong>异或运算</strong>：相同为0，不同为1。2个二进制数做运算，如果2个数相同则为0，如果不同则为1。它的目的是无进位加法。为什么叫无进位加法？就是我们十进制的加法是满10进1位的，异或运算可以看成是2个二进制数相加，当2个二进制数都为1时，<code>1 ^ 1</code>看成是<code>1 + 1</code>本该进位的，但异或运算不进位，所以果为0。举个例子：</p> <p><img src="data:image/png;base64,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" alt="C语言"></p> <h2 id="_5-9-elf"><a href="#_5-9-elf" class="header-anchor">#</a> 5.9 ELF</h2> <p>当使用<code>gcc -S</code>命令生成<code>.s</code>汇编文件后，下一步就是通过汇编器来生成<code>ISA</code>机器码了，而汇编器生成的<code>ISA</code>机器码为<code>0101</code>的二进制文件。既然是<code>ISA</code>指令的二进制文件，那这个二进制文件存放的内容一定会有规定的格式，来约束数据如何存放，这个格式与使用的汇编器相关，使用的汇编器不一样，格式也不一样，汇编器有windows平台的，有unix平台的，我们要研究的肯定是Linux，因为Linux是开源的，在Linux中使用的格式为ELF（Executable and Linkable Format）格式，意为可链接和可执行的格式，这里需要注意的是，可链接和可执行它们是2种文件，且都是二进制文件，它们都属于ELF格式的文件。</p> <h3 id="_5-9-1-o和-out文件"><a href="#_5-9-1-o和-out文件" class="header-anchor">#</a> 5.9.1 .o和.out文件</h3> <p>我们还是使用HelloWorld程序的汇编代码<code>demo.s</code>，执行<code>gcc -c demo.s</code>命令，<code>-c</code>表示编译和汇编但不链接，会生成一个<code>demo.o</code>对象文件。如果想看gcc内部都做了什么，可以执行<code>gcc -c --verbose demo.s</code>命令，<code>--verbose</code>可以看到gcc内部做了什么操作。</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image20.8003d809.png" alt="C语言"></p> <p>可以发现内部其实执行的是<code>as -v --64 -o demo.o demo.s</code>命令，<code>as</code>命令中，使用<code>-o</code>指定了<code>demo.o</code>作为输出文件。</p> <blockquote><p>注：as命令是二进制工具集，用于将汇编代码编译为二进制代码。</p></blockquote> <p><code>.o</code>文件是一个可链接的对象文件，如果不使用<code>-o</code>指定输出文件，比如执行<code>gcc demo.s</code>命令，会直接生成一个默认名为<code>a.out</code>的可执行文件，相当于跳过了生成<code>.o</code>文件这一步，<code>a.out</code>的文件名是默认的，<code>.out</code>文件可以直接运行，也就是如果使用<code>-o</code>指定，就会输出<code>.o</code>可链接的文件，不指定就直接输出<code>.out</code>可执行文件。</p> <p>不管是<code>.o</code>文件还是<code>.out</code>文件，它们都已经是二进制文件了，不可以直接使用<code>cat</code>命令查看，需要使用<code>readelf</code>命令查看，<code>readelf</code>命令用于查看ELF格式文件的信息，使用<code>readelf --help</code>查看帮助文档。</p> <blockquote><p>参考文件资料：《GNU汇编gas权威手册》</p></blockquote> <h3 id="_5-9-2-静态链接"><a href="#_5-9-2-静态链接" class="header-anchor">#</a> 5.9.2 静态链接</h3> <p>前面我们只是知道链接器可以帮我们把多个代码文件链接组合到一起，那它是怎么组合的我们暂时还不知道，那么我们先来了解一下静态链接到底是怎么一回事。现有2个C代码文件分别是<code>demo.c</code>和<code>sum.c</code>，在<code>demo.c</code>中调用了本文件中<code>static</code>的<code>sub()</code>函数，还调用了<code>sum.c</code>文件中的<code>sum()</code>函数：</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image21.5eda60e9.png" alt="C语言"></p> <p>将<code>demo.c</code>和<code>sum.c</code>编译成汇编代码，分别执行<code>gcc -S demo.c</code>和<code>gcc -S sum.c</code>，得到<code>demo.s</code>和<code>sum.s</code>汇编代码：</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image22.9426e9c1.png" alt="C语言"></p> <p>通过汇编代码中，我们可以看到<code>main</code>函数里面有<code>call sub</code>和<code>call sum</code>指令，但此时它们还不能执行，它们目前仅仅只是字符串而已，在sum.s文件中<code>.globl sum</code>声明了<code>sum</code>是一个全局符号。我们继续执行<code>gcc -c demo.s</code>和<code>gcc -c sum.s</code>命令，生成<code>demo.o</code>和<code>sum.o</code>文件，这里注意<code>.o</code>只是可链接的对象文件，还不能运行。然后将<code>.o</code>文件反汇编，使用<code>objdump</code>命令可以查看<code>ELF</code>格式文件的反汇编代码，执行<code>objdump -d demo.o</code>和<code>objdump -d sum.o</code>，<code>-d</code>表示可执行段的汇编代码：</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image23.08b4658c.png" alt="C语言"></p> <p>通过观察<code>.o</code>文件的反汇编代码，可以发现左侧是内存地址，如<code>12:55、13:48 89 e5</code>等，右侧是汇编指令(注意这里是通过反汇编命令查看的汇编代码，但其实它是二进制机器码，是真实的指令)，不过可以发现<code>call sub</code>变成了<code>call 0 &lt;sub&gt;</code>，<code>call sum</code>变成了<code>call 39 &lt;main+0x27&gt;</code>，在反汇编代码中发现<code>sum</code>函数的地址是0：<code>0000000000000000 &lt;sum&gt;</code>，<code>sub</code>函数的地址也是0：<code>0000000000000000 &lt;sub&gt;</code>，这个0地址是需要替换成真实地址的。</p> <p>接下来我们使用<code>readelf -a demo.o</code>命令就可以查看整个<code>.o</code>文件中的内容，<code>-a</code>表示all。</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image24.181441f1.png" alt="C语言"></p> <p>发现.o文件中有几个部分组成，有<code>ELF Headers</code>文件头部，<code>Section Headers</code>节头部，<code>Relocation section '.rela.text'</code>重定位代码段节信息，<code>Symbol table '.symtab'</code>符号表节信息等。<code>ELF Headers</code>中记录了文件的基础信息，如Class、Version、Type等等。<code>Section Headers</code>节头部可以用于定位所有的节。<code>Relocation section '.rela.text'</code>重定位代码段节用于表示哪些需要重定位，<code>Symbol table '.symtab'</code>符号表节表示需要进行重定位的符号定义。</p> <p>在<code>ELF Headers</code>中可以看到<code>Type=REL（Relocatable file）</code>，表示这是一个可重定位文件。在<code>Relocation section '.rela.text'</code>中可以看到<code>sum</code>函数是需要重定位的，<code>Offset</code>是偏移量，<code>000000000035</code>刚好对应objdump反汇编看到的<code>34: e8 00 00 00 00 callq 39 &lt;main+0x27&gt;</code>，这就标识出它是需要重定位的：</p> <table><thead><tr><th>Offset</th> <th>Info</th> <th>Type</th> <th>Sym. Value</th> <th>Sym. Name + Addend</th></tr></thead> <tbody><tr><td>000000000035</td> <td>000a00000004</td> <td>R_X86_64_PLT32</td> <td>0000000000000000</td> <td>sum - 4</td></tr></tbody></table> <p>在<code>Symbol table '.symtab'</code>中也有<code>sum</code>相关的信息，Value是对应函数的地址，发现它们都是0，这更说明这个0的地址是需要替换成真实地址的。</p> <table><thead><tr><th>Num:</th> <th>Value</th> <th>Size</th> <th>Type</th> <th>Bind</th> <th>Vis</th> <th>Ndx</th> <th>Name</th></tr></thead> <tbody><tr><td>5:</td> <td>0000000000000000</td> <td>18</td> <td>FUNC</td> <td>LOCAL</td> <td>DEFAULT</td> <td>1</td> <td>sub</td></tr> <tr><td>10:</td> <td>0000000000000000</td> <td>0</td> <td>NOTYPE</td> <td>GLOBAL</td> <td>DEFAULT</td> <td>UND</td> <td>sum</td></tr></tbody></table> <p>有了<code>.o</code>文件中的这些信息，接下来就可以进行链接了，执行<code>gcc demo.o sum.o</code>命令，将它们链接，生成<code>a.out</code>可执行文件，此时<code>a.out</code>就可以直接执行了。执行<code>objdump -d a.out</code>反汇编，精简后的反汇编代码如下：</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image25.7504fc05.png" alt="C语言">发现call指令中把地址都给写死了，已经变成了真实的地址，这一整个的过程就叫静态链接。那么我们也就知道.o文件其实就是静态链接库文件。那么静态链接它分为2个步骤：</p> <ol><li>生成<code>.o</code>文件。编译成<code>.o</code>文件，这一步通过查看发现将<code>call sum</code>的汇编指令，替换成了为<code>call 39 &lt;main+0x27&gt;</code>，这一步就是将<code>sum</code>符号进行替换，替换的过程叫做符号解析。不过这个解析与地址无关，解析出来的地址都是假的，或者你可以认为它只是做一个填充或者一个标识，标识的作用就是下一步进行链接时，链接器找到这些标识，将它们替换成真实的地址。</li> <li>生成<code>.out</code>文件。将多个<code>.o</code>文件输入给链接器，生成<code>.out</code>可执行文件，将需要重定位的内容进行重定位，替换成真实的地址，重定位信息的数据来就源于<code>.o</code>文件，这一步可以叫做重定位，把假地址进行重定位替换成真实的地址，也就是第一步说的把那些标识给替换成真实的地址，这就等于给它们都链接起来了。</li></ol> <p>那此时再问什么是静态链接？其实就是符号解析+重定位，不过我们发现<code>sub</code>函数是内部的，是不需要重定位的，因为在<code>.o</code>文件的重定位表中没有<code>sub</code>函数相关的记录。而<code>sum</code>函数是外部的，是需要重定位的，在.o文件的重定位表中也有<code>sum</code>函数的记录。所以我们就得出结论，内部符号不需要重定位，外部符号需要重定位。</p> <p>然后通过反汇编<code>.out</code>文件我们看到，静态链接其实就是将多个文件拼到了一起，并替换成了真实的地址。那这种拼合的方式有什么好处呢？好处就是整个程序中都包含了所有代码，即使移植到相同位数的其他平台(比如都是64位机)，也不需要再额外安装其他的函数库，而且不需要解析地址，速度很快。为什么说不需要解析地址呢，还记得前面的学习中提到的，我们的CPU有保护模式，所有的程序由操作系统管理，每个程序运行都好似自己独享了整个内存，也就是虚拟内存，从而实现程序与程序的隔离，所以就不需要解析地址了。</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image26.ca9f881d.png" alt="C语言"></p> <p>不过坏处也很明显，由于整个程序中包含了所有代码，如果多个程序都依赖同一个<code>sum</code>函数，那所有程序中都会有一份这个<code>sum</code>函数的代码，造成代码冗余，且占用空间变大。还有就是如果某一天<code>sum</code>函数改了，所有依赖<code>sum</code>函数的程序全都需要重新编译一遍。</p> <p>由于静态链接的弊端很明显，所以一般都不会使用静态链接，那有没有什么方式能解决呢？比如共享函数库，此时动态链接就登场了。</p> <h3 id="_5-9-3-动态链接"><a href="#_5-9-3-动态链接" class="header-anchor">#</a> 5.9.3 动态链接</h3> <p>动态链接是什么意思呢？就是可以共享使用的链接库，共享就解决了静态链接库代码冗余的问题。我们的程序运行在内存，对于程序来说使用的都是虚拟地址，让程序感觉独占了整个内存一样，那是不是可以在真实的物理内存中存储动态链接库，然后当程序运行时发现调用动态链接库中的函数或数据时，动态的在程序内对动态链接库做一个映射，就完成了动态链接。那么既然是动态的，那程序内调用的动态链接库的函数或数据的地址，只能是相对地址，不可以是绝对地址，也就是不能像静态链接那样把地址写死，而是动态的做地址映射。</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image27.2b2bf1f1.png" alt="C语言"></p> <p>那怎么生成一个动态链接库呢？我们重新编写一下代码，现有<code>demo.c</code>和<code>sum.c</code>代码如下：</p> <details class="custom-block details"><summary>demo.c</summary> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
  
<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></details> <details class="custom-block details"><summary>sum.c</summary> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></details> <p>代码中非常简单，在<code>demo.c</code>中有程序入口<code>main</code>函数，函数内调用了内部的<code>sub</code>函数，还调用了外部的<code>sum</code>函数，然后分别将变量<code>a</code>和变量<code>b</code>打印了一下，需要强调的是<code>printf</code>也是外部函数。</p> <p>现在我们将<code>sum.c</code>文件生成动态链接库，因为需要调用它的<code>sum</code>函数，执行<code>gcc -shared -o libsum.so sum.c</code>，生成<code>libsum.so</code>动态链接库文件，<code>.so</code>用于标识动态链接库文件。</p> <p>接下来是生成<code>.out</code>可执行文件，执行<code>gcc demo.c libsum.so</code>，表示要链接<code>libsum.so</code>文件，然后会生成<code>a.out</code>可执行文件。但此时还不能执行，对于动态链接来说，执行时需要告诉它去哪里找这个动态链接库，执行<code>export LD_LIBRARY_PATH=.:$LD_LIBRARY_PATH</code>，表示动态链接库的位置在当前目录找到，再次执行<code>./a.out</code>，程序就可以运行了。</p> <p>我们先分别看一下<code>libsum.so</code>文件和<code>a.out</code>文件的<code>ELF Header</code>，执行<code>readelf -h libsum.so</code>和<code>readelf -h a.out</code>，<code>-h</code>表示只看<code>ELF Header</code>：</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image28.69cce194.png" alt="C语言"></p> <p>我们首先就发现了，文件的类型不一样，之前在看<code>.o</code>静态链接库文件时：<code>Type=REL(Relocatable file)</code>，说明<code>.o</code>是一个可重定向文件。现在看了<code>.so</code>动态链接库文件：<code>Type=DYN (Shared object file)</code>，说明<code>.so</code>是一个共享目标文件。<code>.out</code>可执行文件：<code>Type=EXEC (Executable file)</code>，说明.out是一个可执行文件。那么我们对于ELF的文件类型，就可以总结出有3种：</p> <ol><li><code>.o</code>：静态链接库文件。可链接的对象文件，也可以叫可重定位文件。</li> <li><code>.so</code>：动态链接库文件。也可以叫共享目标文件。</li> <li><code>.out</code>：可执行文件。直接可以运行的文件。</li></ol> <p>前面我们已经生成了<code>libsum.so</code>动态链接库了，接下来就要看一下，动态链接是怎么动态进行链接的。首先我们需要知道核心的问题在于调用动态链接库的函数或数据时，比如代码中调用的sum函数，程序在编译和链接时，是无法给sum函数填充上地址的，因为它不像静态链接库那样将函数都组合在一个文件里，组合在一个文件中通过偏移量就可以找到函数或数据了，所以想要锁定sum函数的地址，就得把程序运行起来以后，才可以知道sum函数的地址，但是程序运行以后就不好整了，因为我们的代码是存放在代码段中的，程序跑起来以后，为了保护程序，代码段是只读的不能修改，因为如果用一些修改器修改了程序的汇编代码不就等于能控制整个程序了吗，所以想通过修改代码段来替换sum函数的地址是行不通的。不过虽然代码段是只读的，但是数据段是可读可写的呀，那能不能考虑通过数据段中转一下呢？比如程序正在跑着，当第一次调用sum函数时不知道它的地址，接着去查找sum函数的地址，找到以后存放在数据段中，当以后再调用sum函数时，直接通过数据段就能找到sum函数的地址了。这有点像懒加载的意思，更专业的词应该叫延迟重定位，或者叫运行时重定位。那我们来看一下<code>a.out</code>的汇编代码，执行<code>objdump -d a.out</code>，精简后如下：</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image29.92912746.png" alt="C语言"></p> <p>可以看到<code>a.out</code>可执行文件，<code>call</code>调用的<code>sub</code>函数的地址是已经确定了的，因为<code>sub</code>是内部函数，它们在一个文件中，通过偏移量就能找到。但printf函数和sum函数的地址是不确定的，我们以sum函数为例：<code>call 400560 &lt;sum@plt&gt;</code>：</p> <div class="language- extra-class"><pre class="language-text"><code>0000000000400540 &lt;.plt&gt;:
  400540:       ff 35 c2 0a 20 00       pushq  0x200ac2(%rip)	# 601008 &lt;_GLOBAL_OFFSET_TABLE_+0x8&gt;
  400546:       ff 25 c4 0a 20 00       jmpq   *0x200ac4(%rip)	# 601010 &lt;_GLOBAL_OFFSET_TABLE_+0x10&gt;
  40054c:       0f 1f 40 00             nopl   0x0(%rax)

0000000000400560 &lt;sum@plt&gt;:
  400560:       ff 25 ba 0a 20 00       jmpq   *0x200aba(%rip)	# 601020 &lt;sum&gt;
  400566:       68 01 00 00 00          pushq  $0x1
  40056b:       e9 d0 ff ff ff          jmpq   400540 &lt;.plt&gt;
</code></pre></div><p>调用了<code>0000000000400560 &lt;sum@plt&gt;</code>这段代码，这段代码总共3行：</p> <ul><li>jmp 一个地方：这个是跳转到哪里执行，我们还不知道</li> <li>push 一个值：这个在栈中push了一个值，我们也不知道</li> <li>jmp 400540 &lt;.plt&gt;：这个能看出来是跳转到<code>400540 &lt;.plt&gt;</code>这段代码中执行，不过里面执行的是什么，我们还是不知道。</li></ul> <p>那我们就逐个看看它们做了什么操作，通过gdb调试工具，我们先调试一遍，重新编译，执行<code>gcc -g demo.c libsum.so</code>，<code>-g</code>是添加了一些debug调试信息。继续执行<code>export LD_LIBRARY_PATH=.:$LD_LIBRARY_PATH</code>指定动态链接库的位置，执行<code>gdb ./a.out</code>开始调试，在gdb中执行<code>list</code>可以看到我们的代码，我把执行的命令在图上用红框标注出来：</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image30.5c593047.png" alt="C语言"></p> <p>执行<code>break main</code>给main函数添加一个断点，然后执行<code>run</code>，让程序跑起来：</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image31.a86ec04a.png" alt="C语言"></p> <p>断点走到了sub函数，因为sub函数是内部函数，它的地址已经确定了，我们直接跳过，执行2次<code>n</code>，直接跳到sum函数的位置，<code>n</code>表示next单步调试：</p> <p><img src="data:image/png;base64,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" alt="C语言"></p> <p>接着执行<code>disass</code>，查看汇编代码，同时也可以看到断点的位置，即将调用sum函数：</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image33.d2a0a196.png" alt="C语言"></p> <p>不过<code>call 0x400560 &lt;sum@plt&gt;</code>就是前面我们看到的，它现在还不是sum函数真实的地址，执行<code>disass 0x400560</code>，我们看看它是什么：</p> <p><img src="data:image/png;base64,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" alt="C语言"></p> <p>通过查看<code>0x400560 &lt;sum@plt&gt;</code>，发现它就是前面反汇编看到的汇编代码，但我们发现了<code>plt</code>这个关键字，这是个什么东西，它的全称叫Procedure Linkage Table，翻译成中文是程序链接表，它的作用就是在你需要动态链接的程序内添加一段代码，就是图中的那段代码，也可以看成是一个数组，既然是代码它肯定就是只读的，是直接嵌入在<code>a.out</code>可执行文件中。那继续看，它第一行是<code>jmp *0x200aba(%rip)</code>，是要跳转到某个地方去执行，后面也给出了注释，是要跳转到<code>0x601020 &lt;sum@got.plt&gt;</code>中去执行，此时又出现了关键字<code>got</code>，它的全称叫Global Offset Table，翻译成中文是全局偏移表，这个东西就是我们说的，要在数据段存放，用于找到sum函数的地址后要保存的地方。那我们接着看它跳的这个地方是什么，也就是<code>0x601020</code>是什么，执行<code>x 0x601020</code>，<code>x</code>用于查看内存地址中的值：</p> <p><img src="data:image/png;base64,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" alt="C语言"></p> <p>发现它其实是跳转到<code>0x00400566</code>去执行了，那<code>0x00400566</code>是哪里？它就是<code>0x400560 &lt;sum@plt&gt;</code>代码里面的第二行<code>push $0x1</code>，这时我们发现，它跳转过去执行之后，是直接跳转到<code>push $0x1</code>这里了，这里我们其实可以猜测出来，应该是在<code>got</code>表中没有找到<code>sum</code>函数的地址，然后跳回来继续执行后两行代码了，那这个<code>push $0x1</code>是什么？push了个1，我们暂不考虑它，先来验证我们的猜测，我们的猜测是在<code>got</code>表中没有找到<code>sum</code>函数的地址，那接下来肯定是要去找<code>sum</code>函数的地址了，就是会执行<code>jmp 0x400540</code>这个第三行的代码，这个其实在前面我们看到了，这个就是跳转到&lt;.plt&gt;里面去执行了：</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image36.d408417c.png" alt="C语言"></p> <p><code>gdb</code>中继续执行<code>n</code>，单步调试：</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQEAAAAyCAYAAABcdW5KAAAISklEQVR4Ae1dPY7rNhD2bYy9wesfNnuFLJAbvHL7uEyzN3CXbX2GbbbaLieIYcC3SMFgRpzRaERSpH5oy5oFHvRDcubj8JuPlCMxu93Ts8v6t393n+7qjq8/m/qHb+cuJ/eyF9df7263/+WOF+c+D/4+Xot20o48BxzaJtzT9vBeGsvLx7WLjfqY44/qho4ey/njVzxmryd3prgof29fzjn37d4gZtBXjBf0pbkHuP/9+y93/Dq5F7AD1d3VnS/NEWMv7WuM2EbEWl8rPL1xB0xOjB3YxzYeM1xjHXEdqkO4BvxhPCAGVF8eNXZZFjrXvjSXON6anwkuDdkkHDpGqXapMrLnj8hjik8yj6BPYty1D2W3F+/ejVQDHBjkSUtmqK+JgSCc42TptFMk65QJcvmEI2/NUZRH28Gg6r+Mdql+qzIgbyty2p8YjKdnhwPp4Zw/TpzwSRGQA6p8w3g1YiL7KHziWFCZuO/tSDwoQtK+b8t9gzI/lmSRRSxY5nriG/MHfWB+SAx0juPbx5/ka4wTRfwUXAEsMZuEE44Yo4J2MZs61iQA5KvTTnCwh1OVUfvYMRnUWCO7H569ZopLZwbQNoHQtNLwZYMJpW2UXIcIXtLe6i7KlVnydxYjNtCzD3R3thezjJ4tYIrWM8ac42EiMPvY3l3O3R2gOQlsth6fwDbG08fYRCDzh1Ej23SyWQzvM4ZrEYH/fvxwNf+tJS6G00R8MgcmG6ik7jUFAHytJS6G00RgMgcmGzARMMGoxIG1cHV1ONcCWK4ElsJcw8dS2M2urQhGc2B0w8rqXyNBa/hYS7wN54ZEZS2DXSNBa/hYS7wNp4lA+jlXv8e81KpAvKhSI0Fr+LDk2lByLZUXc9sdQ8pJr6mKxA6+c6076F+TrZGgNXyMibe1MeFYlAPFxiEpp7ymWioC/oOZGglaw0dxvLUo2nV6lWrxKY9PKSlhFdD5yoyCrr5wglfa+SuxXpl/F94LwhE+/fV/3IbswvHw3XlRKIk516a0789NBGzGTXIrwJmHqF/UCTmLy4DgffHZp1wt6DJpA8/FBzC6LvnYvxeKgLAJAqS+uov12UTARCDGjYe+X9Q5mcCUoHDUyStFQJ5z3e5KADfZwDK14QP5KBYB/dWduCabgaOJgIlAUT4EOLTK9kWgYyLQ2+hCJF2xCIgVBQXZRKD8OY9iZ0eL3RAHykQgMlOnltz4ewDN/E173p1GiwoIBm2/JYG/ngofB4QIaR/Srjq3lYCtBIryQfFntW2LgUOiBp6xu5tgwK987Ywut5j6PLR76iW3rhIBBtvZCaqTXl8Lu7rv2T4SNrRNuzZhuXsOjAHYe08gIAy9OmMTx9uukaA1fIyJt7UxIVmUA6OM6zcGcbal/8jnj1PeJSDBELN4jQSt4WNUvCkedrTn+yU4sBZS1kjQGj7WEm/DuaHVx1oGu0aC1vCxlngbThOBu1t21UjQGj4suTaUXEss3ZewuRZSygStcb6WuBhOE5XJHJhsYAllCtiskfjSx1riYjhNBCZzYLKBQMIuYVMmaI3zJfpgNi1h75IDdwmqkrBY3y0pjQPPbmdBsEQwDmycA0aAjRMgd9Xl94QI7iWRa6O0nn4prbT9o9UXL8/NmrdFxsT/LrxHBk+S5n3B9ruBIvuPNmiP1J8xIjBEWsEn5I16yzT46jl/ZNZ8jMab0DD/PPe87R5PYUwkrilCE8MydtwlrpiNwCv6k3Ms2wAHK/AlIYIXOw7hgIgv+WIdsvt39z5GNh9yxm6I1EBolfjsP1bGSdDlIQgGJrxvBx+tsUBorBrX4TteV7eV1xEs3AdZN+dc44q04b5Gyov9FzcIKSwH4yeSmr4aDKrwXMDNTpmAeILFtnJ7+7q64+HkzvQJCH0p6se7ua2EPWETiNr7UwmfStQo0ZlrCRG4XPu7SfFKgVCJvsSSL9E/zJsIluKcIi4P+aN67LfJN/aHfRyxCmcD5GDoGBABTHo/wDj4l5M7kjIP2bPysmQeGy8kmNh2Da9bwtC4vewbYvWS0BOUd4ECHNomkJDEg8tFsnnsNElQOjbHFktnuZ7bX0gM/hO2GIe4F+hLUJCG+peLLbee9ofXAjfZCeDHPL61CJw/3t3x0m4u2iMRdcCOdZJex1kTR4n54Hjp9mBf3xu6VpiCiReyq9qlJq7G5sl9ekHARwIQCLkK0TjJpxQwuic3uQm1K8CWwo1l2r4aI26P9QLiMBYLG841EALmVZiX/6E6ufat3jIiESRYS6SHEAG/Enmj3wP89W9/ZoiA3yKPOQw87MVMbIizBE97/uCRpx0jzlVdbyoWNpxrKJTgCEqAjT2z5PqwevMLgSYOCne7VF9OBAQv1LjGVwLd5/0sjiIvG19sl0Tgd/itw/fV8ze2jV3ycUbHUPWnh1NPjkP1tX01Rmzf94se3Tr35Vb/Q/6onA3QjdiRg8cPXt39AAEYF7XkyrYf82v35xEEJBgPUHfsQrMgxb3XzrXby2nS6uunZwcJyX9ySe7Lor/gF04kHRETmGlmlzg6W9xRP/2xb0dwOdC/JL99TkT7qHzzbywcMOFb1O1gFPe5vYpzEiO0H6wgndj5PAl5iziWEvgWGJVPIHt2Aqm2o3ldKD5JP16MSIiSdXPxp/D5ibo4ZrMAy+2A1budiKxQBHZiib82ntLKozghUzmSGkN8dBgpmmsLruG115yNAzNzwAI6c0BTSm5lt1sJWezjsTcRMBEwDmycA0aAjRPAZsj4DLmV2JgImAgYBzbOgYcjwD9/uF3o31ZU3fppM3spB0wENj4LlBLG6j+eyJgImAg8HAdMqIqE6n+h6HZwD5xNzgAAAABJRU5ErkJggg==" alt="C语言"></p> <p>此时<code>sum</code>函数已经执行完了，就说明<code>sum</code>函数是找到了真实的地址，并且执行了，我们再次执行<code>x 0x601020</code>：</p> <p><img src="data:image/png;base64,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" alt="C语言"></p> <p>发现地址变了，这就证实了我们的猜测，在<code>got</code>表中的<code>0xf7bce579</code>就是<code>sum</code>函数真实的地址，当下次再调用<code>sum</code>函数时，直接在<code>got</code>表中就可以找到<code>sum</code>函数的真实地址，就可以直接执行了，此时我们的调试就可以退出了，执行<code>quit</code>退出。</p> <p>我们再看前面未解决的地方：</p> <ul><li>jmp 一个地方，这个已解决，如果在<code>got</code>中找到了<code>sum</code>函数的地址就直接执行，如果找不到就跳回来执行第二行代码。</li> <li>push 一个值，未解决。</li> <li>jmp 400540 &lt;.plt&gt;，未解决。</li></ul> <p>既然是没有找到sum函数的地址，继续执行第二行代码，那肯定就是即将要查找<code>sum</code>的地址了，但第二行是像栈中push一个值，第三行是jmp跳转到别的地方执行，那会不会使想传递什么参数呢？我们先执行<code>readelf -a a.out</code>，看一下a.out里面的内容：</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image39.7656e72a.png" alt="C语言"></p> <p>发现了在<code>.rela.plt</code>节中，printf函数和sum函数在其中，而这两个函数都是需要动态的去查找地址的，printf函数在第0个位置，sum函数在第1个位置，那我们再看一下<code>a.out</code>的汇编代码：</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image40.bd20b0e4.png" alt="C语言"></p> <p><code>printf</code>的plt代码中push的是0，<code>sum</code>的plt代码中push的是1，这是巧合吗？这一定不是巧合，这就是传参数，传递的就是想要查找哪个函数地址的参数，至此我们就解决了plt代码中的第二行代码，至于第三行代码，就是去查找函数真实的地址了，不管是printf还是sum都执行<code>jmp 400540 &lt;.plt&gt;</code>：</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image41.985f60ac.png" alt="C语言"></p> <p><code>&lt;.plt&gt;</code>中的<code>jmp *0x200ac4</code>就是跳转去执行动态链接器的代码，动态链接器去寻找sum函数真实的地址，然后填充在<code>got</code>表中，这样就完成了动态链接的整个过程。<code>plt</code>和<code>got</code>在里面起到了很重要的作用，而至于动态链接库是如何找到<code>sum</code>函数真实的地址，我觉得并不是我们所关心的，因为只需要给动态链接库一个got表的位置，动态链接器找到真实的地址后，填充到got表中就足够了，它如何查找已经不重要了，更重要的是一整个动态链接的过程，如何巧妙的通过跳来跳去的手段来完成动态链接这才是重要的，最后，使用一张图来描述动态链接的大致过程。</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image42.5f756a54.png" alt="C语言"></p> <h3 id="_5-9-4-elf格式说明"><a href="#_5-9-4-elf格式说明" class="header-anchor">#</a> 5.9.4 ELF格式说明</h3> <p>ELF（Executable and Linking Format），意为可执行、可链接格式。可执行和链接格式最初是由UNIX系统实验室(USL)开发并发布的，是应用程序二进制接口(ABI)的一部分。工具接口标准委员会(TIS)选择了不断发展的ELF标准作为可移植的目标文件格式，以使基于32位/64位的Intel架构上运行的应用程序能够在不同操作系统之间运行。</p> <p>ELF标准为开发人员提供统一的二进制接口定义以简化程序员开发应用程序时的复杂性，只要操作系统支持该格式，那么就不要对不同操作系统的目标文件格式来设计对应的代码和接口（当然，这只在类Unix系统中使用，windows它有它的想法），这将减少不同接口实现的数量，从而使应用的源程序代码不需要根据特定的格式来重新编码和重新编译。</p> <blockquote><p>注：ABI（application binary interface）：应用二进制接口，它是一个规范。它指的是一组运行时的工具遵守了某个约定，比如编译器的约定，汇编器的约定，链接器的约定，和语言运行时的支持。</p> <p>ABI：二进制程序表示的所有工具集所遵循的一组运行时约定，包括：编译器、汇编器、连接器和语言运行时支持。有些ABI是正式的，有书面的规范，它们可能是由多个相关组织一起定义并设计的，而其他的一些ABI，只是由一组特定的工具来指定相关的一些约束。</p></blockquote> <p><strong>目标对象文件</strong>：ELF目标对象文件格式分为三种：</p> <ol><li>可重定向文件格式（Relocatable File），如果不理解就想想<code>.o</code>静态链接库，包含部分可执行文件格式或动态链接库格式的数据或代码，需要与其他两种格式之一进行整合。</li> <li>可执行文件格式（Executable File），如果不理解就想想<code>.out</code>可执行文件，包含程序执行所需的代码和数据信息，被操作系统用于创建进程。</li> <li>共享库（Shared Object File），如果不理解就想想<code>.so</code>动态链接库，包含适合在以上两种文件格式中需要链接的代码和数据信息。首先，链接器（Id）可以将它与其他可重定位和共享对象文件一起处理，以创建另一个新的对象文件。其次，动态链接器将共享库与一个可执行文件和其他共享对象结合起来创建一个进程。</li></ol> <p>目标对象文件由汇编器和链接器创建，是程序的二进制表示形式，以表示直接在处理器上执行的代码和数据。</p> <p><strong>目标对象文件格式</strong>：目标对象文件将参与程序链接（用于构建可执行程序）和程序执行（用于构建进程）。为了方便和高效的表示目标对象文件格式，ELF提供了表示文件内容的两种试图，反映了ELF文件在链接和执行时的不同。</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image43.5fd69b76.png" alt="C语言"></p> <p>目标对象文件格式：链接视图和执行视图，尽管图中将程序头部表放置在ELF头信息之后，section头部表紧跟在sections头之后，但实际的文件可能会有所不同。此外，节和段没有指定的顺序。只有ELF头部在文件中有固定的位置。</p> <ul><li>ELF header位于ELF文件最开始的位置，保存着描述文件组织的信息，用于指明ELF文件的元数据信息，如节头部表偏移量(Section header table)、程序头部表偏移量(Program header table)、目标文件类型(静态链接库、可执行文件、动态链接库)。</li> <li>Program header table程序头部表用于告知操作系统如何创建进程。用于构建进程(即<code>.out</code>可执行文件)的文件必须有一个程序头部表。而对于可重定位文件则不需要程序头部表。从图中也可以看到链接视图中的Program header table optional程序头部表是一个可选的，而执行视图则必须有程序头部表。</li> <li>section节保存着链接视图中的大量对象文件信息：指令、数据、符号表、重定位信息等等。</li> <li>section header table节头部表包含了描述文件各节的信息，每个节在表中都有一个条目，每个条目给出了诸如节名、节大小等信息。链接过程中使用的文件(静态链接库)必须有一个节头部表，其他目标对象文件的节头部表是可选的，可能有也可能没有。</li></ul> <h4 id="elf头部信息"><a href="#elf头部信息" class="header-anchor">#</a> ELF头部信息</h4> <ol><li><p>Magic：魔法值。包含MAG0~MAG3，前4个字节包含一个魔法值，用于标识该文件是一个ELF对象文件。</p> <ul><li><p>MAG0：0x7f</p></li> <li><p>MAG1：E</p></li> <li><p>MAG2：L</p></li> <li><p>MAG3：F</p></li></ul></li> <li><p>Class：用来标识文件的类型。</p></li> <li><p>Data：指定了在文件中与特定处理器相关的数据的编码方式。</p></li> <li><p>Version：表示ELF文件格式的版本信息。CURRENT的值将根据需要更改为当前的版本号。</p> <ul><li><p>EV_NONE：0</p></li> <li><p>EV_CURRENT：1</p></li></ul></li> <li><p>OS/ABI：操作系统/应用程序二进制接口信息</p></li> <li><p>Type：表示目标对象文件的类型。常见的为REL、EXEC、DYN。</p></li> <li><p>Machine：单个文件所需的体系结构信息。</p> <ul><li><p>No machine</p></li> <li><p>SPARC</p></li> <li><p>Intel 80386</p></li> <li><p>MIPS I Architecture</p></li> <li><p>PowerPC</p></li> <li><p>Advanced RISC Machines ARM</p></li> <li><p>Advanced Micro Devices X86-64</p></li></ul></li> <li><p>Version：版本信息。</p></li> <li><p>Entry point address：标识程序执行入口的虚拟地址 。</p></li> <li><p>Start of program headers：该值用于保存程序头部表的文件偏移量(单位：字节)，如果没有程序头部表该值为0。</p></li> <li><p>Start of section headers：该值用于保存节头部表的文件偏移量（单位：字节），如果没有节头部表该值为0。</p></li> <li><p>Flags：保存与文件相关的特定处理器标志。</p></li> <li><p>Size of this header：该值用于保存ELF头部信息的大小(单位：字节)。</p></li> <li><p>Size of program headers：该值用于保存程序头部表中一个表项的固定字节大小，所有表项的大小相同。</p></li> <li><p>Number of program headers：该值用于保存程序头部表中的表项数。如果没有程序头部表该值为0。</p></li> <li><p>Size of section headers：该值用于保存节头部表中一个表项的固定字节大小，所有表项的大小相同。</p></li> <li><p>Number of section headers：该值用于保存节头部表中的表项数。如果没有程序头部表该值为0。</p></li> <li><p>Section header string table index：该值用于保存着与字符串表相关联的节头表索引。</p></li></ol> <details class="custom-block details"><summary>ELF Header示例</summary> <div class="language- extra-class"><pre class="language-text"><code>ELF Header:
  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 
  Class:                             ELF64
  Data:                              2's complement, little endian
  Version:                           1 (current)
  OS/ABI:                            UNIX - System V
  ABI Version:                       0
  Type:                              EXEC (Executable file)
  Machine:                           Advanced Micro Devices X86-64
  Version:                           0x1
  Entry point address:               0x400570
  Start of program headers:          64 (bytes into file)
  Start of section headers:          17864 (bytes into file)
  Flags:                             0x0
  Size of this header:               64 (bytes)
  Size of program headers:           56 (bytes)
  Number of program headers:         9
  Size of section headers:           64 (bytes)
  Number of section headers:         35
  Section header string table index: 34
</code></pre></div></details> <h4 id="节头部-section-headers"><a href="#节头部-section-headers" class="header-anchor">#</a> 节头部 Section headers</h4> <ol><li><p>Name：表示节的名称。它的值是一个节头字符串表的索引下标。</p></li> <li><p>Type：对节的内容和语义进行分类。分类如下：</p> <ul><li><p>NULL：将节标记为非活动状态。</p></li> <li><p>PROGBITS：保存着由程序定义的节信息，其格式和含义完全由程序决定。</p></li> <li><p>SHT_SYMTAB和SHT_DYNSYM：表示当前节保存着一个符号表。SHT_SYMTAB表示提供了用于链接器静态链接的符号，其作为一个完整的符号表，它可能包含许多动态链接中不需要的符号，因此，一个对象文件也可以包含一个SHT_DYNSYM的节用于保存动态链接符号的最小集合，以节省空间。所以我们可以通过strip去掉完整的符号表，但这会导致不能进行静态链接。</p></li> <li><p>SHT_STRTAB：表示当前节位字符串表。</p></li> <li><p>SHT_RELA：表示当前节保存着带有显示加数的重定位表项。</p></li> <li><p>SHT_HASH：表示当前节保存着一个符号哈希表。所有参与动态链接的对象文件必须包含一个符号哈希表。</p></li> <li><p>SHT_DYNAMIC：表示当前节保存动态链接信息。</p></li> <li><p>SHT_NOTE：表示当前节保存文件的注释信息。</p></li> <li><p>SHT_NOBITS：表示不占任何空间的节信息，虽然该节不包含字节，但是Offset包含概念上的文件偏移量。</p></li> <li><p>SHT_REL：表示该节保存着没有显示加数的重定位表项。</p></li> <li><p>SHT_SHLIB：该节类型是保留的，但具有未指定的语义。包含这种类型的部分的程序不符合ABI规范。</p></li> <li><p>SHT_LOPROC与SHT_HIPROC：这个范围内的值为特定于处理器的语义保留。</p></li> <li><p>SHT_LOUSER：该类型的节表示应用程序保留的索引范围的下限。</p></li> <li><p>SHT_HIUSER：该类型的节表示应用程序保留的索引范围的上限。</p></li></ul></li> <li><p>Address：如果该section节将出现在进程的内存虚拟地址中，该值将给出该section节的第一个字节所在的地址。否则该值为0。</p></li> <li><p>Offset：该值给出了从文件开头到当前节的第一个字节的偏移量。</p></li> <li><p>Size：该值以字节为单位给出当前节的大小。</p></li> <li><p>EntSize：有些节保存着一个固定大小的表项，比如一个符号表。对于这样的节，该值给出每个表项的字节大小。如果节中没有固定大小的表项，则该成员为0。</p></li> <li><p>Flags：节支持描述其他属性的位标志。标志定义如下：</p> <ul><li><p>SHF_WRITE：表示该节中包含在进程执行期间可写的数据。</p></li> <li><p>SHF_ALLOC：表示该节在进程执行期间占用的内存。</p></li> <li><p>SHF_EXECINSTR：表示该节包含可执行的机器指令。</p></li> <li><p>SHF_MASKPROC：这个掩码中包含的所有位都为特定处理器语义保留。</p></li></ul></li> <li><p>Link：该值表示一个节头标索引链接，其解释取决于当前节的类型。</p></li> <li><p>Info：该值用于表示额外的信息，其解释取决于当前节的类型。</p></li> <li><p>Align：用于指定节对齐值。有些节需要指定地址对齐，例如，如果一个节保存着一个双字(32位)，系统必须确保整个节的双字对齐。即Address的值必须以Align的值取模且结果必须为0。</p></li></ol> <details class="custom-block details"><summary>Section headers示例</summary> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span>Nr<span class="token punctuation">]</span> Name              Type             Address           Offset
       Size              EntSize          Flags  Link  Info  Align
  <span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">]</span>                   <span class="token constant">NULL</span>             <span class="token number">0000000000000000</span>  <span class="token number">00000000</span>
       <span class="token number">0000000000000000</span>  <span class="token number">0000000000000000</span>           <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">0</span>
  <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">.</span>interp           <span class="token constant">PROGBITS</span>         <span class="token number">0000000000400238</span>  <span class="token number">00000238</span>
       000000000000001c  <span class="token number">0000000000000000</span>   <span class="token constant">A</span>       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">1</span>
  <span class="token punctuation">[</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">.</span>note<span class="token punctuation">.</span><span class="token constant">ABI</span><span class="token operator">-</span>tag     <span class="token constant">NOTE</span>             <span class="token number">0000000000400254</span>  <span class="token number">00000254</span>
       <span class="token number">0000000000000020</span>  <span class="token number">0000000000000000</span>   <span class="token constant">A</span>       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">4</span>
  <span class="token punctuation">[</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">.</span>note<span class="token punctuation">.</span>gnu<span class="token punctuation">.</span>build<span class="token operator">-</span>i <span class="token constant">NOTE</span>             <span class="token number">0000000000400274</span>  <span class="token number">00000274</span>
       <span class="token number">0000000000000024</span>  <span class="token number">0000000000000000</span>   <span class="token constant">A</span>       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">4</span>
  <span class="token punctuation">[</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token punctuation">.</span>gnu<span class="token punctuation">.</span>hash         <span class="token constant">GNU_HASH</span>         <span class="token number">0000000000400298</span>  <span class="token number">00000298</span>
       <span class="token number">0000000000000030</span>  <span class="token number">0000000000000000</span>   <span class="token constant">A</span>       <span class="token number">5</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token punctuation">.</span>dynsym           <span class="token constant">DYNSYM</span>           00000000004002c8  000002c8
       00000000000000f0  <span class="token number">0000000000000018</span>   <span class="token constant">A</span>       <span class="token number">6</span>     <span class="token number">1</span>     <span class="token number">8</span>
</code></pre></div></details> <h4 id="程序头部表-program-header-table"><a href="#程序头部表-program-header-table" class="header-anchor">#</a> 程序头部表 Program header table</h4> <ol><li><p>Type：表示当前描述的段类型。它包含：</p> <ul><li><p>NULL：标识程序头部数组中当前项该段未使用，其他变量的值未定义，将会被操作系统加载时忽略。</p></li> <li><p>LOAD：标识程序头部数组中当前项一个可加载的段，由FileSiz和MemSiz共同描述，用于将文件中指定偏移量的字节被映射到对应内存中。如果段的内存大小(MemSiz)大于文件大小(FileSiz)，则多与字节用0填充，并位于段初始化区域之后。文件大小不能大于内存大小，程序头部表中的可加载段将按VirtAddr的地址升序排列(即虚拟地址的高低排布)。</p></li> <li><p>DYNAMIC：表示程序头部数组中当前项的动态链接信息。</p></li> <li><p>INTERP：表示程序头部数组中当前项要作为解释器(动态链接器)调用的以空白符结尾的路径名的位置和大小。这个段类型只对可执行文件有意义(虽然它可能发生在共享对象中)，它在一个文件中只能出现一次，如果存在该类型的数组项，那么它必须位于任何可加载段条目之前。</p></li> <li><p>NOTE：表示程序头部数组中当前项辅助信息的位置和大小。</p></li> <li><p>SHLIB：此段类型为保留类型，具有未指定的语义。包含这种类型的程序不符合ABI规范定义。</p></li> <li><p>PHDR：表示程序头部数组中当前项的程序头部表在文件和程序内存映像中的位置和大小。该段类型在一个文件中只能出现一次，而且，只有当程序头部表本身需要作为进程的一部分时才会出现，如果存在，它必须位于任何加载段条目之前。</p></li> <li><p>LOPROC到HIPROC：这两个是一个范围。这个范围内的值为特定于处理器的语义保留。</p></li></ul></li> <li><p>Offset：表示段的第一个字节从文件开始的偏移量。</p></li> <li><p>VirtAddr：表示段的第一个字节在内存中的虚拟地址。</p></li> <li><p>PhysAddr：在与物理寻址相关的操作系统上，保留用于标识段的物理地址。由于System V忽略应用程序的物理寻址，所以该变量在可执行文件和共享对象文件表示未指定的内容，通常与VirtAddr相同。(System V， 曾经也被称为 AT&amp;T System V，是Unix操作系统众多版本中的一支。它最初由 AT&amp;T 开发，在1983年第一次发布。一共发行了4个 System V 的主要版本：版本1、2、3 和 4。System V Release 4，或者称为 SVR4，是最成功的版本，成为一些 UNIX 共同特性的源头，例如 ”SysV 初始化脚本“ （/etc/init.d），用来控制系统启动和关闭，System V Interface Definition (SVID) 是一个System V 如何工作的标准定义。)</p></li> <li><p>FileSiz：表示段的目标文件中占用的总字节数，可能为0。</p></li> <li><p>MemSiz：表示段在内存中占用的总字节数，可能为0。</p></li> <li><p>Flags：表示段相关的标志。</p></li> <li><p>Align：可加载的进程段必须为VirtAddr和Offset取页面大小模的一致值，即内存对齐，这时使用该变量给出了在内存和文件中对这些段进行对齐的值。值0和1表示不需要对齐，否则，Align应为2的正整数次幂，同时VirtAddr应为Offset取Align的模。</p></li></ol> <details class="custom-block details"><summary>Program Header Table示例</summary> <div class="language-js extra-class"><pre class="language-js"><code>Program Headers<span class="token operator">:</span>
  Type           Offset             VirtAddr           PhysAddr
                 FileSiz            MemSiz              Flags  Align
  <span class="token constant">PHDR</span>           <span class="token number">0x0000000000000040</span> <span class="token number">0x0000000000400040</span> <span class="token number">0x0000000000400040</span>
                 <span class="token number">0x00000000000001f8</span> <span class="token number">0x00000000000001f8</span>  <span class="token constant">R</span>      <span class="token number">0x8</span>
  <span class="token constant">INTERP</span>         <span class="token number">0x0000000000000238</span> <span class="token number">0x0000000000400238</span> <span class="token number">0x0000000000400238</span>
                 <span class="token number">0x000000000000001c</span> <span class="token number">0x000000000000001c</span>  <span class="token constant">R</span>      <span class="token number">0x1</span>
      <span class="token punctuation">[</span>Requesting program interpreter<span class="token operator">:</span> <span class="token operator">/</span>lib64<span class="token operator">/</span>ld<span class="token operator">-</span>linux<span class="token operator">-</span>x86<span class="token operator">-</span><span class="token number">64</span><span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">2</span><span class="token punctuation">]</span>
  <span class="token constant">LOAD</span>           <span class="token number">0x0000000000000000</span> <span class="token number">0x0000000000400000</span> <span class="token number">0x0000000000400000</span>
                 <span class="token number">0x00000000000008b8</span> <span class="token number">0x00000000000008b8</span>  <span class="token constant">R</span> <span class="token constant">E</span>    <span class="token number">0x200000</span>
  <span class="token constant">LOAD</span>           <span class="token number">0x0000000000000df0</span> <span class="token number">0x0000000000600df0</span> <span class="token number">0x0000000000600df0</span>
                 <span class="token number">0x000000000000023c</span> <span class="token number">0x0000000000000240</span>  <span class="token constant">RW</span>     <span class="token number">0x200000</span>
  <span class="token constant">DYNAMIC</span>        <span class="token number">0x0000000000000e00</span> <span class="token number">0x0000000000600e00</span> <span class="token number">0x0000000000600e00</span>
                 <span class="token number">0x00000000000001e0</span> <span class="token number">0x00000000000001e0</span>  <span class="token constant">RW</span>     <span class="token number">0x8</span>
  <span class="token constant">NOTE</span>           <span class="token number">0x0000000000000254</span> <span class="token number">0x0000000000400254</span> <span class="token number">0x0000000000400254</span>
                 <span class="token number">0x0000000000000044</span> <span class="token number">0x0000000000000044</span>  <span class="token constant">R</span>      <span class="token number">0x4</span>
  <span class="token constant">GNU_EH_FRAME</span>   <span class="token number">0x000000000000076c</span> <span class="token number">0x000000000040076c</span> <span class="token number">0x000000000040076c</span>
                 <span class="token number">0x0000000000000044</span> <span class="token number">0x0000000000000044</span>  <span class="token constant">R</span>      <span class="token number">0x4</span>
  <span class="token constant">GNU_STACK</span>      <span class="token number">0x0000000000000000</span> <span class="token number">0x0000000000000000</span> <span class="token number">0x0000000000000000</span>
                 <span class="token number">0x0000000000000000</span> <span class="token number">0x0000000000000000</span>  <span class="token constant">RW</span>     <span class="token number">0x10</span>
  <span class="token constant">GNU_RELRO</span>      <span class="token number">0x0000000000000df0</span> <span class="token number">0x0000000000600df0</span> <span class="token number">0x0000000000600df0</span>
                 <span class="token number">0x0000000000000210</span> <span class="token number">0x0000000000000210</span>  <span class="token constant">R</span>      <span class="token number">0x1</span>   
</code></pre></div></details> <h4 id="特殊的节"><a href="#特殊的节" class="header-anchor">#</a> 特殊的节</h4> <p>用于保存程序信息和控制信息。下面列表中的部分由操作系统使用，并具有指定的类型和属性。</p> <ul><li>bss：表示该节保存着未初始化的数据，这些数据构成了程序的数据内存排布。根据定义，当程序开始运行时，系统用零初始化这些数据。节类型SHT_NOBITS表示该节不占用文件空间。</li> <li>comment：持有注释信息。</li> <li>data 和 data1：表示该节保存着已经初始化的数据，这些数据构成了程序的数据内存排布。</li> <li>debug：表示该节保存了用于调试的符号信息。</li> <li>dynamic：表示该节保存动态链接信息。</li> <li>dynstr：表示该节保存动态链接所需的字符串，最常见的是表示符号表项相关名称的字符串。</li> <li>dynsym：表示该节保存着动态链接符号表。</li> <li>fini：表示该节保存了进程终止代码的可执行指令。也就是说，当一个程序正常退出时将会执行这一部分的代码。</li> <li>got：表示该节保存了全局偏移量表。</li> <li>hash：表示该节保存了符号hash表。</li> <li>init：表示该节保存了进程初始化代码的可执行指令。也就是说，当一个程序开始运行时，将会在调用主程序入口点（C程序的main函数）之前执行这一部分的代码。</li> <li>interp：表示该节保存程序动态链接器的路径名。如果文件中有一个包含该节的可加载段，该节的属性将包括SHF_ALLOC位。</li> <li>line：表示该节保存用于符号调试的行号信息，它描述了源程序和机器码之间的对应关系。</li> <li>note：表示该节保存了标注信息。</li> <li>plt：表示该节保存了程序连接表信息。</li> <li>rel name 和 rela name：表示该节保存着重定位信息。如果文件中有一个包含重定位的可加载段，则节的属性将包含 SHF_ALLOC 。通常，name 由重定位的节提供。因此.text 的重定位节的名称通常为.rel.text 或 .rela.text。</li> <li>rodata 和 rodata1：表示该节保存只读数据，这些数据通常会在进程中形成一个不可写的数据段。</li> <li>shstrtab：表示该节保存节的名字。</li> <li>strtab：表示该节保存字符串信息，最常见的是表示与符号表项关联的名称的字符串。</li> <li>symtab：表示该节保存符号表信息。</li> <li>text：表示当前节包含程序的可执行的指令序列信息。</li></ul> <h4 id="字符串表接信息-string-table"><a href="#字符串表接信息-string-table" class="header-anchor">#</a> 字符串表接信息 String Table</h4> <p>字符串表节保存以空白符结尾的字符序列，也被称为字符串。目标对象文件使用这些字符串来表示符号和节名，那么如何使用这些字符串呢？只需要让使用这些字符串的符号保存一个指向字符串表的索引下标即可。在字符串表节中，第一个字节，也就是索引下标为0处，被定义为一个空白符。同样，字符串表的最后一个字节也被定义为保存一个空白符，确保所有字符串以空白符结束。对于空字符串表，其他非零索引下标访问无效。</p> <p>一个节头部的sh_name变量保存着字符串表的索引下标。下图显示了一个包含25个字节的字符串表，以及与各种索引下标关联的字符串。</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image44.2e71903b.png" alt="C语言"></p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image45.bd9ed880.png" alt="C语言"></p> <p>如图所示，每个节中可以保存字符串表的索引下标，并且一个字符串可以引用多次，也可能存在对子字符串的引用，也允许引用空白字符串。这就达到了一个字符串表的字符串公用。</p> <h4 id="符号表节信息-symbol-table"><a href="#符号表节信息-symbol-table" class="header-anchor">#</a> 符号表节信息（Symbol Table）</h4> <ol><li><p>Value：该值用于保存关联符号的值。根据上下文的不同，这可以是绝对值、地址等。</p></li> <li><p>Size：该值用于保存符号的大小。例如：数据对象的大小是该对象中所包含的字节数。如果符号没有大小或大小未知，该值为0.</p></li> <li><p>Type：该值用于表示符号的类型。分类如下：</p> <ul><li><p>NOTYPE：表示符号的类型未指定。</p></li> <li><p>OBJECT：表示符号与实际数据对象相关联，如变量、数组等。</p></li> <li><p>FUNC：表示该符号与一个函数或其他可执行代码相关联。</p></li> <li><p>SECTION：表示该符号与一个相关联。这种类型的符号表项主要用于重定位。</p></li> <li><p>FILE：表示符号与目标文件相关联的源文件名称。</p></li> <li><p>LOPROC到HIPROC这个范围内的值为特定于处理器的语义保留。</p></li></ul></li> <li><p>Bind：该值用于保存符号的类型和绑定属性。</p> <ul><li><p>LOCAL：表示局部符号，在其定义的目标文件之外是不可见的。相同名称的局部符号可以存在于多个文件中，而且不会相互干扰。</p></li> <li><p>GLOBAL：表示全局符号，该符号对于所有合并的目标文件都是可见的。需要全局唯一。</p></li> <li><p>WEAK：表示弱符号，弱符号类似全局符号，但它们的定义优先级较低。即可以出现相同名的全局符号和弱符号，但是强符号优先级高于弱符号。</p></li> <li><p>LOPROC到HIPROC这个范围内的值为特定于处理器的语义保留。</p></li></ul></li></ol> <p>全局符号和弱符号的区别主要体现在：当链接器组合几个可重定位的对象文件时，它不允许GLOBAL符号具有相同名称的多个定义。但是，如果已定义的全局符号存在，则出现同名的弱符号不会导致错误，此时将忽略弱符号。</p> <ol start="5"><li><p>Vis：该值目前都是默认，目前没有实际意义。</p></li> <li><p>Ndx：该值用于保存着与之相关联的节头部表的索引下标。</p></li> <li><p>Name：该值用于保存目标文件的字符串表(即String Table)的索引下标。</p></li></ol> <details class="custom-block details"><summary>Symbol Table示例</summary> <div class="language- extra-class"><pre class="language-text"><code>Symbol table '.symtab' contains 13 entries:
   Num:    Value          Size Type    Bind   Vis      Ndx Name
     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND 
     1: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS demo.c
     2: 0000000000000000     0 SECTION LOCAL  DEFAULT    1 
     3: 0000000000000000     0 SECTION LOCAL  DEFAULT    3 
     4: 0000000000000000     0 SECTION LOCAL  DEFAULT    4 
     5: 0000000000000000    18 FUNC    LOCAL  DEFAULT    1 sub
     6: 0000000000000000     0 SECTION LOCAL  DEFAULT    5 
     7: 0000000000000000     0 SECTION LOCAL  DEFAULT    7 
     8: 0000000000000000     0 SECTION LOCAL  DEFAULT    8 
     9: 0000000000000000     0 SECTION LOCAL  DEFAULT    6 
    10: 0000000000000012    96 FUNC    GLOBAL DEFAULT    1 main
    11: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT  UND printf
    12: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT  UND sum
</code></pre></div></details> <h4 id="符号值信息-symbol-values"><a href="#符号值信息-symbol-values" class="header-anchor">#</a> 符号值信息（Symbol Values）</h4> <p>不同对象文件类型的符号表项对st_value成员的解释略有不同：</p> <ol><li>在可重定位文件中，st_value保存一个符号的对齐约束。</li> <li>在可重定位文件中，st_value保存一个已定义符号的节偏移量，也即st_value是从st_shndx标识的部分开始的偏移量。</li> <li>在可执行和共享目标文件中，st_value保存一个用于内存排布的虚拟地址。</li></ol> <p>虽然符号表的值对于不同的目标文件有相似的含义，但这些数据由程序控制进行更加有效地访问。</p> <h4 id="重定位信息"><a href="#重定位信息" class="header-anchor">#</a> 重定位信息</h4> <p>重定位就是将符号引用与符号定义连接起来的过程。例如：call sum指令，必须在执行时将调用函数符号分配适当的目标地址，如call 0x600010。</p> <ol><li><p>Offset：该值用于标识程序需要重定位操作的位置。对于可重定位的文件，该值为从节开头到需要重定位的存储单元的字节偏移量。对于可执行文件或共享对象，该值为需要重定位的存储单元的虚拟地址。</p></li> <li><p>Info：该值用于标识必须进行重定位的符号表索引，以及要应用的重定位类型。例如：调用指令的重定位表项将保存被调用函数的符号表索引。如果索引是UNDEF，即未定义的符号索引，则重定位使用0作为其符号值。重定位类型是特定于处理器的，如Intel：R_X86_64_PC32（PC 相对地址）、R_X86_64_32（绝对地址）。</p></li> <li><p>Type：重定位类型。链接器将合并一个或多个可重定位的文件并将它们组合成一个新的目标文件。它首先决定如何组合和定位输入文件，然后更新符号值，最后执行重定位。应用于可执行或共享目标文件的重定位是类似的，具有相同的实现。符号对应的意义：</p> <ul><li><p>A：表示加数，用于计算可重定位字段的值</p></li> <li><p>B：表示在执行期间将共享对象加载到内存中的基址。通常，共享对象文件使用虚拟地址0作为基址构建，但执行地址会有所不同</p></li> <li><p>G：表示在执行期间重定位表项的符号所在的全局偏移表的偏移量</p></li> <li><p>GOT：表示GOT表的首地址</p></li> <li><p>L ：表示过程链接表项中符号的位置（节偏移量或地址）。过程链接表项将函数调用重定向到正确的地址。静态链接器负责构建过程链接表，动态链接器在执行期间修改GOT.PLT表项（后面还会详细描述）</p></li> <li><p>P：表示重新定位后的存储单元位置（相对偏移量或绝对地址，使用r_offset计算得出)</p></li> <li><p>S：表示在重定位表项中对应下标处的符号值</p></li></ul></li></ol> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image46.245a3efe.png" alt="C语言"></p> <ul><li>R_386_GOT32：该重定位类型用于计算从全局偏移表的基地址到全局偏移表符号地址的距离。此外，它还指示链接器构建一个全局偏移量表（GOT）</li> <li>R_386_PLT32：该重定位类型用于计算过程链接表项的地址，并指示链接器构建一个过程链接表（PLT）。</li> <li>R_386_COPY：该重定位类型用于链接器为动态链接创建这种重定位类型。它的offset变量指向可写段中的一个位置。符号表索引指定了一个应该同时存在于当前对象文件和共享对象文件中的符号。在执行过程中，动态链接器将与共享对象符号相关的数据复制到由偏移量指定的位置</li> <li>R_386_GLOB_DAT：该重定位类型用于将全局偏移表项设置为指定符号的地址</li> <li>R_3862_JMP_SLOT：链接器在需要动态链接时创建这种重定位类型。它的offset变量给出了过程链接表项（也即GOT.PLT 后面会讲）的位置。动态链接器根据该偏移量修改过程链接表项，将控制转移到指定符号的真实地址。</li> <li>R_386_RELATIVE：链接器为动态链接创建这种重定位类型。它的offset变量给出了共享对象的位置，该位置使用相对地址来表示。动态链接器通过将加载共享对象时的虚拟地址与该相对地址相加来计算相应的虚拟地址</li> <li>R_386_GOTOFF：该重定位类型用于计算符号值与全局偏移表地址之间的差值。它还指示链接器构建全局偏移量表。</li> <li>R_386_GOTPC：该重定位类型类似于R_386_PC32，只是它在计算中使用了全局偏移表的地址。在重定位中引用的符号通常是GLOBAL_OFFSET_TABLE，它也指示链接器构建全局偏移表</li></ul> <ol start="4"><li><p>Addend：该值用于标识指定一个常量加数，用于计算存储在可重定位字段中的值。例如：call sum，此时sum地址为<code>0x4004e8</code>，而<code>addend</code>为<code>-4</code>，那么最终地址为<code>call 0x4004e8 - 4</code>，相关计算与Info的重定位类型有关。</p></li> <li><p>Sym. Value和Sym. Name列记录了对应符号表中的Value和Name列的值。</p></li></ol> <details class="custom-block details"><summary>Relocation示例</summary> <div class="language-js extra-class"><pre class="language-js"><code>Relocation section <span class="token string">'.rela.plt'</span> at offset <span class="token number">0x4e8</span> contains <span class="token number">2</span> <span class="token literal-property property">entries</span><span class="token operator">:</span>
  Offset          Info           Type           Sym<span class="token punctuation">.</span> Value    Sym<span class="token punctuation">.</span> Name <span class="token operator">+</span> Addend
<span class="token number">000000601018</span>  <span class="token number">000200000007</span> <span class="token constant">R_X86_64_JUMP_SLO</span> <span class="token number">0000000000000000</span> printf@<span class="token constant">GLIBC_2</span><span class="token number">.2</span><span class="token number">.5</span> <span class="token operator">+</span> <span class="token number">0</span>
<span class="token number">000000601020</span>  <span class="token number">000500000007</span> <span class="token constant">R_X86_64_JUMP_SLO</span> <span class="token number">0000000000000000</span> sum <span class="token operator">+</span> 0console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'你好，VuePress！'</span><span class="token punctuation">)</span>
</code></pre></div></details> <blockquote><p>参考文献说明：更多内容请阅读《Executable and Linkable Format(ELF)手册》</p></blockquote> <h3 id="_5-9-5-内存对齐"><a href="#_5-9-5-内存对齐" class="header-anchor">#</a> 5.9.5 内存对齐</h3> <p>分页的内容暂时还没有介绍，会在之后的内容中介绍。在Intel中，内存不止分段，因为分段后每个段过大会导致内存碎片问题，所以在分段的基础上，进行了分页，也就是将内存分成很多个足够小的页来解决内存碎片问题，也规定了分页的大小，最小页为4K，最大页为4M。假设按4K分页时，考虑一下内存对齐和内存不对齐会有什么区别：</p> <p><img src="https://lmq2582609.github.io/sun-blog/assets/img/image47.699d5182.png" alt="C语言"></p> <p>以4K分页为例，假设图中每2个格子为4K。左侧展示为内存不对齐，右侧展示为内存对齐。观察两幅图，很明显内存对齐的数据更规整，也更有利于读取。而内存不对齐的数据和其他数据同处于连续空间内，可能要操作两次或两次以上的内存才能将数据读取出来。当然内存是否可以不对齐这是由硬件决定的，Intel是支持的，但性能会下降。</p> <h3 id="_5-9-6-程序入口"><a href="#_5-9-6-程序入口" class="header-anchor">#</a> 5.9.6 程序入口</h3> <p>通过观察<code>Program Header Table</code>程序头部表发现，在64位机中，程序的起始位置是<code>0x400000</code>，通过<code>objdump -d a.out</code>反汇编查看，main函数并不是起始地址，也就是说它并不是程序的起始函数。</p> <details class="custom-block details"><summary>Program Header Table示例</summary> <div class="language- extra-class"><pre class="language-text"><code>Program Headers:
  Type           Offset             VirtAddr           PhysAddr
                 FileSiz            MemSiz              Flags  Align
  LOAD           0x0000000000000000 0x0000000000400000 0x0000000000400000
                 0x00000000000008b8 0x00000000000008b8  R E    0x200000
  LOAD           0x0000000000000df0 0x0000000000600df0 0x0000000000600df0
                 0x000000000000023c 0x0000000000000240  RW     0x200000
</code></pre></div></details> <p>为什么起始地址是0x400000？因为指针在初始化<code>int *p = NULL</code>时（在GLIBC中NULL为0），说明将0地址作为无效地址，也就是空地址来使用，只要向这个地址写入，就会报空指针异常。既然0是不能用的，为了内存对齐，选择了最大分页大小进行内存地址，即4M，为了兼容4K~4M的对齐地址。为什么选择按4M对齐？因为按4K对齐，如果分页是按照4M来分页，就不能支持了，所以选择了最大分页大小作为起始地址，这一块的内存在前面也有介绍过，就是位于内存最底部的一块区域。如果你认为这个选择是以空间换时间的话，请不要有这种想法，因为如果在一个64位机中，程序所使用的的虚拟地址空间位264个byte，这个地址空间非常大，所以根本不存在空间换时间。在32位机中，起始地址是<code>0x804800</code>，了解即可。</p> <p>那程序的第一行代码在哪里？程序的第一行代码是由编译器生成的代码来调用，通过<code>readelf -h a.out</code>查看ELF Header发现程序入口地址为<code>0x400570</code>：</p> <div class="language- extra-class"><pre class="language-text"><code>ELF Header:
  Entry point address:               0x400570
  其他内容省略......
</code></pre></div><p>结合汇编代码（执行<code>objdump -d a.out</code>），我们可以找到<code>0x400570</code>的代码：</p> <div class="language- extra-class"><pre class="language-text"><code>0000000000400570 &lt;_start&gt;:
  400570:       f3 0f 1e fa             endbr64 
  400574:       31 ed                   xor    %ebp,%ebp
  400576:       49 89 d1                mov    %rdx,%r9
  400579:       5e                      pop    %rsi
  40057a:       48 89 e2                mov    %rsp,%rdx
  40057d:       48 83 e4 f0             and    $0xfffffffffffffff0,%rsp
  400581:       50                      push   %rax
  400582:       54                      push   %rsp
  400583:       49 c7 c0 40 07 40 00    mov    $0x400740,%r8
  40058a:       48 c7 c1 d0 06 40 00    mov    $0x4006d0,%rcx
  400591:       48 c7 c7 68 06 40 00    mov    $0x400668,%rdi
  400598:       ff 15 4a 0a 20 00       callq  *0x200a4a(%rip)   # 600fe8 &lt;__libc_start_main@GLIBC_2.2.5&gt;
  40059e:       f4                      hlt    
</code></pre></div><h2 id="_5-10-堆内存管理"><a href="#_5-10-堆内存管理" class="header-anchor">#</a> 5.10 堆内存管理</h2> <p>堆内存的分配，由低地址向高地址扩张。在C语言中，我们可以使用<code>malloc</code>函数动态分配内存空间，使用<code>free</code>函数释放内存空间。那么在分配内存空间时，可能面临2种情况，一种是小内存的分配，另一种是大内存的分配。</p> <p>小内存分配：小内存的分配一个指针就可以了，就是保存一个edata指针，由低地址向高地址扩张推指针，但这会有一些问题，就是不好释放内存，因为指针一直在向上推，中间的内存得不到释放，无法有效利用内存。也有一些好处，就是分配简单，只需要推指针就可以了。edata推的区域叫主分配区。</p> <p><img src="data:image/png;base64,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" alt="C语言"></p> <p>大内存分配：大内存分配就没有那么简单，因为不能使用edata指针那种方式了，大内存分配需要先查找空闲内存，找到空闲内存后进行分配，这种大内存的分配方式叫mmap。mmap映射出来的内存区域叫非主分配区。</p> <p><img src="data:image/png;base64,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" alt="C语言"></p> <p>void* malloc(size_t size);：直接在堆内存分配，要么用edata分配，要么用mmap分配，分配后返回指针，这块分配的空间不会初始化，它们的值是未知的，size参数是字节。
void* calloc(size_t num, size_t size);：与malloc函数类似，不过calloc会将每一个字节都初始化为0。参数表示为分配num个长度为size的连续空间。
void* realloc(void *ptr, size_t size);：重分配。将ptr所指向的内存块的大小修改为size，并返回新的内存指针。
void *p = malloc(10);
void *q = realoc(p, 15);</p> <details class="custom-block details"><summary>malloc.c源码</summary> <div class="language-js extra-class"><pre class="language-js"><code>glibc阈值 malloc<span class="token punctuation">.</span>c中的阈值
<span class="token constant">DEFAULT_MMAP_THRESHOLD</span>     <span class="token number">128</span> <span class="token operator">*</span> <span class="token number">1024</span>
<span class="token constant">DEFAULT_MMAP_MAX</span>           <span class="token number">65536</span>


<span class="token comment">//这个就是传进去的av    </span>
<span class="token keyword">static</span> struct malloc_state main_arena <span class="token operator">=</span>
<span class="token punctuation">{</span>
  <span class="token punctuation">.</span>mutex <span class="token operator">=</span> _LIBC_LOCK_INITIALIZER<span class="token punctuation">,</span>
  <span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token operator">&amp;</span>main_arena<span class="token punctuation">,</span>
  <span class="token punctuation">.</span>attached_threads <span class="token operator">=</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">/* There are no usable arenas.  Fall back to sysmalloc to get a chunk from
     mmap.  */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__glibc_unlikely</span> <span class="token punctuation">(</span>av <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">void</span> <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token function">sysmalloc</span> <span class="token punctuation">(</span>nb<span class="token punctuation">,</span> av<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token function">alloc_perturb</span> <span class="token punctuation">(</span>p<span class="token punctuation">,</span> bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    

<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token operator">*</span>
<span class="token function">sysmalloc</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token constant">INTERNAL_SIZE_T</span> nb<span class="token punctuation">,</span> mstate av</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>    
    <span class="token comment">/*
      If have mmap, and the request size meets the mmap threshold, and
      the system supports mmap, and there are few enough currently
      allocated mmapped regions, try to directly map this request
      rather than expanding top.
    */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>av <span class="token operator">==</span> <span class="token constant">NULL</span>
          <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>unsigned long<span class="token punctuation">)</span> <span class="token punctuation">(</span>nb<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token punctuation">(</span>unsigned long<span class="token punctuation">)</span> <span class="token punctuation">(</span>mp_<span class="token punctuation">.</span>mmap_threshold<span class="token punctuation">)</span>
    	  <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>mp_<span class="token punctuation">.</span>n_mmaps <span class="token operator">&lt;</span> mp_<span class="token punctuation">.</span>n_mmaps_max<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></details> <details class="custom-block details"><summary>test.c</summary> <div class="language-js extra-class"><pre class="language-js"><code>#include <span class="token operator">&lt;</span>stdio<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
#include <span class="token operator">&lt;</span>stdlib<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
int <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>p1 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   		<span class="token comment">//输出 -&gt; 0x1522260</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>p2 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">129</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//输出 -&gt; 0x1522280</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


#include <span class="token operator">&lt;</span>stdio<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
#include <span class="token operator">&lt;</span>stdlib<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
int <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>p1 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   			<span class="token comment">//输出 -&gt; 0x23c7260</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>p2 <span class="token operator">=</span> <span class="token function">realloc</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//输出 -&gt; 0x23c7260</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>p3 <span class="token operator">=</span> <span class="token function">realloc</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> <span class="token number">129</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//输出 -&gt; 0x23c7260</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>p3 <span class="token operator">=</span> <span class="token function">realloc</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> <span class="token number">129</span><span class="token operator">*</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//输出 -&gt; 0x7fc1240ef010</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></details> <p>通过glibc源码看到阈值是DEFAULT_MMAP_THRESHOLD，大于128*1024使用mmap分配，为什么realloc分配129*1024后，输出的地址是一样的呢？一定是有一个容忍值。</p></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/4/第4章-汇编语言.html" class="prev">
          第4章-汇编语言
        </a></span> <!----></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/5/%E7%AC%AC5%E7%AB%A0-C%E8%AF%AD%E8%A8%80.html#_5-1-函数" class="sidebar-link reco-side-_5-1-函数" data-v-b57cc07c>5.1 函数</a></li><li class="level-3" data-v-b57cc07c><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/5/%E7%AC%AC5%E7%AB%A0-C%E8%AF%AD%E8%A8%80.html#_5-1-1-汇编call、ret、leave指令执行过程" class="sidebar-link reco-side-_5-1-1-汇编call、ret、leave指令执行过程" data-v-b57cc07c>5.1.1 汇编call、ret、leave指令执行过程</a></li><li class="level-3" data-v-b57cc07c><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/5/%E7%AC%AC5%E7%AB%A0-C%E8%AF%AD%E8%A8%80.html#_5-1-2-helloworld程序的汇编代码" class="sidebar-link reco-side-_5-1-2-helloworld程序的汇编代码" data-v-b57cc07c>5.1.2 HelloWorld程序的汇编代码</a></li><li class="level-3" data-v-b57cc07c><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/5/%E7%AC%AC5%E7%AB%A0-C%E8%AF%AD%E8%A8%80.html#_5-1-3-数据的传递" class="sidebar-link reco-side-_5-1-3-数据的传递" data-v-b57cc07c>5.1.3 数据的传递</a></li><li class="level-2" data-v-b57cc07c><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/5/%E7%AC%AC5%E7%AB%A0-C%E8%AF%AD%E8%A8%80.html#_5-2-extern关键字" class="sidebar-link reco-side-_5-2-extern关键字" data-v-b57cc07c>5.2 extern关键字</a></li><li class="level-2" data-v-b57cc07c><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/5/%E7%AC%AC5%E7%AB%A0-C%E8%AF%AD%E8%A8%80.html#_5-3-static关键字" class="sidebar-link reco-side-_5-3-static关键字" data-v-b57cc07c>5.3 static关键字</a></li><li class="level-2" data-v-b57cc07c><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/5/%E7%AC%AC5%E7%AB%A0-C%E8%AF%AD%E8%A8%80.html#_5-4-指针" class="sidebar-link reco-side-_5-4-指针" data-v-b57cc07c>5.4 指针</a></li><li class="level-3" data-v-b57cc07c><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/5/%E7%AC%AC5%E7%AB%A0-C%E8%AF%AD%E8%A8%80.html#_5-4-1-指针的应用" class="sidebar-link reco-side-_5-4-1-指针的应用" data-v-b57cc07c>5.4.1 指针的应用</a></li><li class="level-3" data-v-b57cc07c><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/5/%E7%AC%AC5%E7%AB%A0-C%E8%AF%AD%E8%A8%80.html#_5-4-2-二级指针" class="sidebar-link reco-side-_5-4-2-二级指针" data-v-b57cc07c>5.4.2 二级指针</a></li><li class="level-2" data-v-b57cc07c><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/5/%E7%AC%AC5%E7%AB%A0-C%E8%AF%AD%E8%A8%80.html#_5-5-sizeof-函数" class="sidebar-link reco-side-_5-5-sizeof-函数" data-v-b57cc07c>5.5 sizeof()函数</a></li><li class="level-3" data-v-b57cc07c><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/5/%E7%AC%AC5%E7%AB%A0-C%E8%AF%AD%E8%A8%80.html#_5-5-1-size-t关键字" class="sidebar-link reco-side-_5-5-1-size-t关键字" data-v-b57cc07c>5.5.1 size_t关键字</a></li><li class="level-2" data-v-b57cc07c><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/5/%E7%AC%AC5%E7%AB%A0-C%E8%AF%AD%E8%A8%80.html#_5-6-字符串的结尾" class="sidebar-link reco-side-_5-6-字符串的结尾" data-v-b57cc07c>5.6 字符串的结尾</a></li><li class="level-2" data-v-b57cc07c><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/5/%E7%AC%AC5%E7%AB%A0-C%E8%AF%AD%E8%A8%80.html#_5-7-宏定义-宏处理" class="sidebar-link reco-side-_5-7-宏定义-宏处理" data-v-b57cc07c>5.7 宏定义/宏处理</a></li><li class="level-2" data-v-b57cc07c><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/5/%E7%AC%AC5%E7%AB%A0-C%E8%AF%AD%E8%A8%80.html#_5-8-与运算、或运算、异或运算" class="sidebar-link reco-side-_5-8-与运算、或运算、异或运算" data-v-b57cc07c>5.8 与运算、或运算、异或运算</a></li><li class="level-2" data-v-b57cc07c><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/5/%E7%AC%AC5%E7%AB%A0-C%E8%AF%AD%E8%A8%80.html#_5-9-elf" class="sidebar-link reco-side-_5-9-elf" data-v-b57cc07c>5.9 ELF</a></li><li class="level-3" data-v-b57cc07c><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/5/%E7%AC%AC5%E7%AB%A0-C%E8%AF%AD%E8%A8%80.html#_5-9-1-o和-out文件" class="sidebar-link reco-side-_5-9-1-o和-out文件" data-v-b57cc07c>5.9.1 .o和.out文件</a></li><li class="level-3" data-v-b57cc07c><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/5/%E7%AC%AC5%E7%AB%A0-C%E8%AF%AD%E8%A8%80.html#_5-9-2-静态链接" class="sidebar-link reco-side-_5-9-2-静态链接" data-v-b57cc07c>5.9.2 静态链接</a></li><li class="level-3" data-v-b57cc07c><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/5/%E7%AC%AC5%E7%AB%A0-C%E8%AF%AD%E8%A8%80.html#_5-9-3-动态链接" class="sidebar-link reco-side-_5-9-3-动态链接" data-v-b57cc07c>5.9.3 动态链接</a></li><li class="level-3" data-v-b57cc07c><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/5/%E7%AC%AC5%E7%AB%A0-C%E8%AF%AD%E8%A8%80.html#_5-9-4-elf格式说明" class="sidebar-link reco-side-_5-9-4-elf格式说明" data-v-b57cc07c>5.9.4 ELF格式说明</a></li><li class="level-3" data-v-b57cc07c><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/5/%E7%AC%AC5%E7%AB%A0-C%E8%AF%AD%E8%A8%80.html#_5-9-5-内存对齐" class="sidebar-link reco-side-_5-9-5-内存对齐" data-v-b57cc07c>5.9.5 内存对齐</a></li><li class="level-3" data-v-b57cc07c><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/5/%E7%AC%AC5%E7%AB%A0-C%E8%AF%AD%E8%A8%80.html#_5-9-6-程序入口" class="sidebar-link reco-side-_5-9-6-程序入口" data-v-b57cc07c>5.9.6 程序入口</a></li><li class="level-2" data-v-b57cc07c><a href="/https:/lmq2582609.github.io/sun-blog/computer-dao/5/%E7%AC%AC5%E7%AB%A0-C%E8%AF%AD%E8%A8%80.html#_5-10-堆内存管理" class="sidebar-link reco-side-_5-10-堆内存管理" data-v-b57cc07c>5.10 堆内存管理</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="https://lmq2582609.github.io/sun-blog/assets/js/app.911b0be4.js" defer></script><script src="https://lmq2582609.github.io/sun-blog/assets/js/4.eab32c03.js" defer></script><script src="https://lmq2582609.github.io/sun-blog/assets/js/1.3b1cd4a9.js" defer></script><script src="https://lmq2582609.github.io/sun-blog/assets/js/3.047693cb.js" defer></script>
  </body>
</html>
